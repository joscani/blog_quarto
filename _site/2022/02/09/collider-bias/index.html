<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.269">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="jlcr">
<meta name="dcterms.date" content="2022-02-09">

<title>Muestrear no es pecado - Collider Bias?</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../../">
<script src="../../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="../../../../site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="../../../../site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="../../../../site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../../../index.html">
    <span class="navbar-title">Muestrear no es pecado</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../../blog.html">
 <span class="menu-text">Blog</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../about.html">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/joscani"><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/joscani"><i class="bi bi-twitter" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://fosstodon.org/@joscani"><i class="bi bi-mastodon" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="../../../../blog.xml"><i class="bi bi-rss" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-resources" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Resources</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-resources">    
        <li>
    <a class="dropdown-item" href="https://rweekly.org/">
 <span class="dropdown-text">R Weekly</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://www.r-bloggers.com/">
 <span class="dropdown-text">R Bloggers</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://www.datanalytics.com/">
 <span class="dropdown-text">Datanalytics</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../../../../archive.html">
 <span class="menu-text">Archivo</span></a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#full-luxury-bayes" id="toc-full-luxury-bayes" class="nav-link active" data-scroll-target="#full-luxury-bayes">Full luxury bayes</a>
  <ul class="collapse">
  <li><a href="#modelo-bayesiano-sin-condicionar-por-el-collider" id="toc-modelo-bayesiano-sin-condicionar-por-el-collider" class="nav-link" data-scroll-target="#modelo-bayesiano-sin-condicionar-por-el-collider">Modelo bayesiano sin condicionar por el collider</a></li>
  <li><a href="#modelo-condicionando-por-el-collider" id="toc-modelo-condicionando-por-el-collider" class="nav-link" data-scroll-target="#modelo-condicionando-por-el-collider">Modelo condicionando por el collider</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Collider Bias?</h1>
  <div class="quarto-categories">
    <div class="quarto-category">bayesian</div>
    <div class="quarto-category">R</div>
    <div class="quarto-category">causal inference</div>
    <div class="quarto-category">estadística</div>
  </div>
  </div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>jlcr </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">February 9, 2022</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<p>Continuando con temas del post anterior. Dice Pearl, con buen criterio, que si condicionas por un collider abres ese camino causal y creas una relación espuria entre las dos variables “Tratamiento” y “Respuesta” y por lo tanto si condicionas por el collider, aparece un sesgo.</p>
<p>Hablando estilo compadre. Si Tratamiento -&gt; Collider y Respuesta -&gt; Collider, si condiciono en el Collider, es decir, calculo la relación entre Tratamiento y Respuesta para cada valor de C, se introduce un sesgo.</p>
<p>Si <span class="math display">\[C = 2\cdot Tratamiento + 3 \cdot respuesta\]</span></p>
<p>Si sé que C = 3, y que Tratamiento = 4 , ya hay relación entre Tratamiento y respuesta aunque sean independientes, porque ambos son causa de C.</p>
<p>Simulemos, que es una buena forma de ver qué pasa si condiciono por el collider, siendo el tratamiento y la respuesta independientes.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">155</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>N <span class="ot">=</span> <span class="dv">1000</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>tratamiento <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(N, <span class="dv">2</span>, <span class="dv">1</span>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>respuesta <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(N, <span class="dv">4</span>, <span class="fl">1.5</span>)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(tratamiento, respuesta)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.05006728</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>collider <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(N, <span class="dv">2</span><span class="sc">*</span>tratamiento <span class="sc">+</span> <span class="dv">3</span> <span class="sc">*</span> respuesta, <span class="fl">1.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Si no ajusto por el collider, obtengo que no hay efecto del tratamiento , <strong>correcto</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">lm</span>(respuesta <span class="sc">~</span> tratamiento))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = respuesta ~ tratamiento)

Residuals:
    Min      1Q  Median      3Q     Max 
-4.7322 -1.0113 -0.0443  0.9587  6.3922 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  3.90287    0.10626  36.730   &lt;2e-16 ***
tratamiento  0.07591    0.04793   1.584    0.114    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 1.471 on 998 degrees of freedom
Multiple R-squared:  0.002507,  Adjusted R-squared:  0.001507 
F-statistic: 2.508 on 1 and 998 DF,  p-value: 0.1136</code></pre>
</div>
</div>
<p>Condicionando, <strong>aparece el sesgo</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">lm</span>(respuesta <span class="sc">~</span> tratamiento <span class="sc">+</span> collider))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = respuesta ~ tratamiento + collider)

Residuals:
     Min       1Q   Median       3Q      Max 
-1.59183 -0.30533  0.00423  0.30028  1.33536 

Coefficients:
             Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  0.377392   0.050478   7.476 1.67e-13 ***
tratamiento -0.599046   0.016860 -35.530  &lt; 2e-16 ***
collider     0.300697   0.003196  94.087  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.4683 on 997 degrees of freedom
Multiple R-squared:  0.899, Adjusted R-squared:  0.8988 
F-statistic:  4439 on 2 and 997 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p>Retomando el ejemplo del último <a href="https://muestrear-no-es-pecado.netlify.app/2022/02/06/pluralista/">post</a>, pero en vez de tener una variable de confusión no observable, tenemos un collider.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dagitty)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggdag)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>g <span class="ot">&lt;-</span> <span class="fu">dagitty</span>(<span class="st">"dag{ </span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="st">  M -&gt; D ;</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="st">  B2 -&gt; D;</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="st">  B1 -&gt; M;</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="st">  M -&gt; C;</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="st">  D -&gt; C</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="st"> }"</span>)</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>coords <span class="ot">&lt;-</span>  </span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">c</span>(<span class="at">B1 =</span> <span class="dv">1</span>, <span class="at">M =</span> <span class="dv">2</span>,  <span class="at">C =</span> <span class="fl">3.5</span>, <span class="at">D =</span> <span class="dv">5</span>, <span class="at">B2 =</span> <span class="dv">6</span>),</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> <span class="fu">c</span>(<span class="at">B1 =</span> <span class="dv">0</span>, <span class="at">M =</span> <span class="dv">0</span>, <span class="at">C =</span> <span class="dv">1</span>, <span class="at">D =</span> <span class="dv">0</span>, <span class="at">B2 =</span> <span class="dv">0</span> ) </span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a><span class="fu">coordinates</span>(g) <span class="ot">&lt;-</span> coords</span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a><span class="fu">ggdag</span>(g) <span class="sc">+</span> </span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="index_files/figure-html/unnamed-chunk-4-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-1"><img src="index_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>Usando la función <code>adjustmentSets</code> de <code>dagitty</code> nos dice sobre qué variables hay que condicionar si quiero el efecto causal total y directo de M sobre D, siguiendo las reglas de Pearl, ver por ejemplo (J. Pearl (2009), Causality: Models, Reasoning and Inference. Cambridge University Press.)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">adjustmentSets</span>(g, <span class="at">exposure =</span> <span class="st">"M"</span>, <span class="at">outcome =</span> <span class="st">"D"</span>, <span class="at">effect =</span> <span class="st">"total"</span>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> {}</code></pre>
</div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">adjustmentSets</span>(g, <span class="at">exposure =</span> <span class="st">"M"</span>, <span class="at">outcome =</span> <span class="st">"D"</span>, <span class="at">effect =</span> <span class="st">"direct"</span>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> {}</code></pre>
</div>
</div>
<p>Simulo unos datos dónde fuerzo a que no haya efecto causal de M a D.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">155</span>)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="dv">1000</span> <span class="co"># número de pares, 1000 madres y 1000 hijas</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a> <span class="co"># Simulamos el collider</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="co"># orden de nacimiento y </span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>B1 <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(N,<span class="at">size=</span><span class="dv">1</span>,<span class="at">prob=</span><span class="fl">0.5</span>)  <span class="co"># 50% de madres nacieeron en primer lugar</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>M <span class="ot">&lt;-</span> <span class="fu">rnorm</span>( N , <span class="dv">2</span> <span class="sc">*</span> B1  )</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>B2 <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(N,<span class="at">size=</span><span class="dv">1</span>,<span class="at">prob=</span><span class="fl">0.5</span>) <span class="co"># 50% son las primogénitas</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>D <span class="ot">&lt;-</span> <span class="fu">rnorm</span>( N , <span class="dv">2</span>  <span class="sc">*</span> B2  <span class="sc">+</span> <span class="dv">0</span> <span class="sc">*</span> M )</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Simulamos el collider</span></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>C <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(N, <span class="dv">3</span> <span class="sc">*</span> M <span class="sc">+</span> <span class="dv">4</span><span class="sc">*</span>D, <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>En grafo sería</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>g_sin_efecto_M_D <span class="ot">&lt;-</span> <span class="fu">dagitty</span>(<span class="st">"dag{ </span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="st">  B2 -&gt; D;</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="st">  B1 -&gt; M;</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="st">  M -&gt; C;</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="st">  D -&gt; C</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="st"> }"</span>)</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>coords <span class="ot">&lt;-</span>  </span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">c</span>(<span class="at">B1 =</span> <span class="dv">1</span>, <span class="at">M =</span> <span class="dv">2</span>,  <span class="at">C =</span> <span class="fl">3.5</span>, <span class="at">D =</span> <span class="dv">5</span>, <span class="at">B2 =</span> <span class="dv">6</span>),</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> <span class="fu">c</span>(<span class="at">B1 =</span> <span class="dv">0</span>, <span class="at">M =</span> <span class="dv">0</span>, <span class="at">C =</span> <span class="dv">1</span>, <span class="at">D =</span> <span class="dv">0</span>, <span class="at">B2 =</span> <span class="dv">0</span> ) </span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a><span class="fu">coordinates</span>(g_sin_efecto_M_D) <span class="ot">&lt;-</span> coords</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a><span class="fu">ggdag</span>(g_sin_efecto_M_D) <span class="sc">+</span> </span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="index_files/figure-html/unnamed-chunk-7-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-2"><img src="index_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>Y vemos lo de antes,</p>
<p>Vemos si hay efecto causal de M sobre D (uso modelos lineales por simplicidad).</p>
<p>El modelo correcto sería sin condicionar por el collider. Y bien, hace lo que debe, no hay efecto de M sobre D, tal y como sabemos que pasa en la realidad</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">lm</span>(D <span class="sc">~</span> M))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = D ~ M)

Residuals:
    Min      1Q  Median      3Q     Max 
-3.8810 -1.0553 -0.0175  1.0941  3.8417 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  1.02722    0.05414  18.973   &lt;2e-16 ***
M           -0.02899    0.03207  -0.904    0.366    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 1.398 on 998 degrees of freedom
Multiple R-squared:  0.0008181, Adjusted R-squared:  -0.0001831 
F-statistic: 0.8171 on 1 and 998 DF,  p-value: 0.3662</code></pre>
</div>
</div>
<p>Condicionando ahora por el collider, tenemos sesgo.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># condicionor por collider</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">lm</span>(D <span class="sc">~</span> M <span class="sc">+</span> C))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = D ~ M + C)

Residuals:
    Min      1Q  Median      3Q     Max 
-1.5621 -0.3135  0.0103  0.3344  1.5110 

Coefficients:
             Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  0.099571   0.021630   4.603 4.69e-06 ***
M           -0.654545   0.013280 -49.290  &lt; 2e-16 ***
C            0.220029   0.002567  85.700  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.4837 on 997 degrees of freedom
Multiple R-squared:  0.8806,    Adjusted R-squared:  0.8803 
F-statistic:  3676 on 2 and 997 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># condiciono por collider y orden de nacimiento de la hija</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">lm</span>(D <span class="sc">~</span> M <span class="sc">+</span> C <span class="sc">+</span> B2))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = D ~ M + C + B2)

Residuals:
    Min      1Q  Median      3Q     Max 
-1.6166 -0.3133 -0.0101  0.2978  1.3493 

Coefficients:
             Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) -0.021313   0.022464  -0.949    0.343    
M           -0.577228   0.013905 -41.513   &lt;2e-16 ***
C            0.194496   0.003176  61.239   &lt;2e-16 ***
B2           0.463625   0.037877  12.240   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.4512 on 996 degrees of freedom
Multiple R-squared:  0.8962,    Adjusted R-squared:  0.8959 
F-statistic:  2866 on 3 and 996 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># condiciono por collider y orden de nacimiento de la hija y de la madre</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">lm</span>(D <span class="sc">~</span> M <span class="sc">+</span> C <span class="sc">+</span> B2 <span class="sc">+</span> B1)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = D ~ M + C + B2 + B1)

Residuals:
    Min      1Q  Median      3Q     Max 
-1.6187 -0.3049 -0.0050  0.3041  1.3514 

Coefficients:
             Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) -0.028298   0.024109  -1.174    0.241    
M           -0.585068   0.017022 -34.371   &lt;2e-16 ***
C            0.194286   0.003187  60.954   &lt;2e-16 ***
B2           0.464258   0.037892  12.252   &lt;2e-16 ***
B1           0.032672   0.040904   0.799    0.425    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.4512 on 995 degrees of freedom
Multiple R-squared:  0.8963,    Adjusted R-squared:  0.8958 
F-statistic:  2149 on 4 and 995 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p>Queda como curiosidad que si condicionas por B1 en vez de por el collider también hay sesgo, pero si condicionas solo por B2, no hay.</p>
<section id="full-luxury-bayes" class="level2">
<h2 class="anchored" data-anchor-id="full-luxury-bayes">Full luxury bayes</h2>
<p>No todos los DAg’s son tan sencillos como el que he puesto, hay veces en los que una misma variable puede ser a la vez un collider y una variable de confusión, porque puede haber varios path causales y tenga diferente rol. En esos casos, condicionar por el collider te abre un path, y si no condicionas te abre otro. Ante esas situaciones, y suponiendo que el dag es correcto, no se podría estimar el efecto causal.</p>
<p>Sin embargo, condicionar en la red bayesiana no significa lo mismo que condicionar en un sólo modelo, sino que significa que introduzco la información que me proporciona el collider en la distribución conjunta y que me obtenga la posteriori.</p>
<p>Al estimar el DAG completo, usando <a href="https://mc-stan.org/">Stan</a> por ejemplo, se estima tanto el modelo para M, como para D de forma conjunta.</p>
<section id="modelo-bayesiano-sin-condicionar-por-el-collider" class="level3">
<h3 class="anchored" data-anchor-id="modelo-bayesiano-sin-condicionar-por-el-collider">Modelo bayesiano sin condicionar por el collider</h3>
<p>Formulamos el modelo usando la librería <code>rethinking</code> y lo ajustamos usando la función <code>ulam</code> que por debajo llama a Stan</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cmdstanr)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rethinking)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set_cmdstan_path</span>(<span class="st">"~/Descargas/cmdstan/"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">N =</span> N,</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">M =</span> M,</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">D =</span> D,</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">B1 =</span> B1,</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">B2 =</span> B2, </span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">C =</span> C</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">155</span>)</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>flbi <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">alist</span>(</span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># mom model</span></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>    M <span class="sc">~</span> <span class="fu">normal</span>( mu , sigma ),</span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> a1 <span class="sc">+</span> b<span class="sc">*</span>B1 ,</span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># daughter model</span></span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>    D <span class="sc">~</span> <span class="fu">normal</span>( nu , tau ),</span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>    nu <span class="ot">&lt;-</span> a2 <span class="sc">+</span> b<span class="sc">*</span>B2 <span class="sc">+</span> m<span class="sc">*</span>M ,</span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># B1 and B2</span></span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a>    B1 <span class="sc">~</span> <span class="fu">bernoulli</span>(p),</span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a>    B2 <span class="sc">~</span> <span class="fu">bernoulli</span>(p),</span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># priors</span></span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(a1,a2,b,m) <span class="sc">~</span> <span class="fu">normal</span>( <span class="dv">0</span> , <span class="fl">0.5</span> ),</span>
<span id="cb24-26"><a href="#cb24-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(k,sigma,tau) <span class="sc">~</span> <span class="fu">exponential</span>( <span class="dv">1</span> ),</span>
<span id="cb24-27"><a href="#cb24-27" aria-hidden="true" tabindex="-1"></a>    p <span class="sc">~</span> <span class="fu">beta</span>(<span class="dv">2</span>,<span class="dv">2</span>)</span>
<span id="cb24-28"><a href="#cb24-28" aria-hidden="true" tabindex="-1"></a>  ), <span class="at">data=</span>dat , <span class="at">chains=</span><span class="dv">4</span> , <span class="at">cores=</span><span class="dv">4</span> , <span class="at">warmup =</span> <span class="dv">500</span>, <span class="at">iter=</span><span class="dv">2500</span> , <span class="at">cmdstan=</span><span class="cn">TRUE</span> )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in '/tmp/Rtmpsdysi4/model-8eef3881083c.stan', line 6, column 4: Declaration
    of arrays by placing brackets after a variable name is deprecated and
    will be removed in Stan 2.32.0. Instead use the array keyword before the
    type. This can be changed automatically using the auto-format flag to
    stanc
Warning in '/tmp/Rtmpsdysi4/model-8eef3881083c.stan', line 7, column 4: Declaration
    of arrays by placing brackets after a variable name is deprecated and
    will be removed in Stan 2.32.0. Instead use the array keyword before the
    type. This can be changed automatically using the auto-format flag to
    stanc</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Running MCMC with 4 parallel chains, with 1 thread(s) per chain...

Chain 1 Iteration:    1 / 2500 [  0%]  (Warmup) 
Chain 2 Iteration:    1 / 2500 [  0%]  (Warmup) </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 Exception: normal_lpdf: Scale parameter is 0, but must be positive! (in '/tmp/Rtmpsdysi4/model-8eef3881083c.stan', line 39, column 4 to column 29)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 2 </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Chain 3 Iteration:    1 / 2500 [  0%]  (Warmup) </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 Exception: normal_lpdf: Scale parameter is 0, but must be positive! (in '/tmp/Rtmpsdysi4/model-8eef3881083c.stan', line 39, column 4 to column 29)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 3 </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Chain 4 Iteration:    1 / 2500 [  0%]  (Warmup) </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 Informational Message: The current Metropolis proposal is about to be rejected because of the following issue:</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 Exception: normal_lpdf: Scale parameter is 0, but must be positive! (in '/tmp/Rtmpsdysi4/model-8eef3881083c.stan', line 35, column 4 to column 27)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 If this warning occurs sporadically, such as for highly constrained variable types like covariance matrices, then the sampler is fine,</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 but if this warning occurs often then your model may be either severely ill-conditioned or misspecified.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Chain 4 </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Chain 1 Iteration:  100 / 2500 [  4%]  (Warmup) 
Chain 2 Iteration:  100 / 2500 [  4%]  (Warmup) 
Chain 4 Iteration:  100 / 2500 [  4%]  (Warmup) 
Chain 1 Iteration:  200 / 2500 [  8%]  (Warmup) 
Chain 2 Iteration:  200 / 2500 [  8%]  (Warmup) 
Chain 3 Iteration:  100 / 2500 [  4%]  (Warmup) 
Chain 4 Iteration:  200 / 2500 [  8%]  (Warmup) 
Chain 1 Iteration:  300 / 2500 [ 12%]  (Warmup) 
Chain 3 Iteration:  200 / 2500 [  8%]  (Warmup) 
Chain 4 Iteration:  300 / 2500 [ 12%]  (Warmup) 
Chain 1 Iteration:  400 / 2500 [ 16%]  (Warmup) 
Chain 2 Iteration:  300 / 2500 [ 12%]  (Warmup) 
Chain 3 Iteration:  300 / 2500 [ 12%]  (Warmup) 
Chain 4 Iteration:  400 / 2500 [ 16%]  (Warmup) 
Chain 1 Iteration:  500 / 2500 [ 20%]  (Warmup) 
Chain 1 Iteration:  501 / 2500 [ 20%]  (Sampling) 
Chain 2 Iteration:  400 / 2500 [ 16%]  (Warmup) 
Chain 3 Iteration:  400 / 2500 [ 16%]  (Warmup) 
Chain 4 Iteration:  500 / 2500 [ 20%]  (Warmup) 
Chain 4 Iteration:  501 / 2500 [ 20%]  (Sampling) 
Chain 4 Iteration:  600 / 2500 [ 24%]  (Sampling) 
Chain 1 Iteration:  600 / 2500 [ 24%]  (Sampling) 
Chain 2 Iteration:  500 / 2500 [ 20%]  (Warmup) 
Chain 2 Iteration:  501 / 2500 [ 20%]  (Sampling) 
Chain 3 Iteration:  500 / 2500 [ 20%]  (Warmup) 
Chain 3 Iteration:  501 / 2500 [ 20%]  (Sampling) 
Chain 3 Iteration:  600 / 2500 [ 24%]  (Sampling) 
Chain 4 Iteration:  700 / 2500 [ 28%]  (Sampling) 
Chain 1 Iteration:  700 / 2500 [ 28%]  (Sampling) 
Chain 1 Iteration:  800 / 2500 [ 32%]  (Sampling) 
Chain 2 Iteration:  600 / 2500 [ 24%]  (Sampling) 
Chain 3 Iteration:  700 / 2500 [ 28%]  (Sampling) 
Chain 4 Iteration:  800 / 2500 [ 32%]  (Sampling) 
Chain 1 Iteration:  900 / 2500 [ 36%]  (Sampling) 
Chain 2 Iteration:  700 / 2500 [ 28%]  (Sampling) 
Chain 2 Iteration:  800 / 2500 [ 32%]  (Sampling) 
Chain 3 Iteration:  800 / 2500 [ 32%]  (Sampling) 
Chain 4 Iteration:  900 / 2500 [ 36%]  (Sampling) 
Chain 1 Iteration: 1000 / 2500 [ 40%]  (Sampling) 
Chain 2 Iteration:  900 / 2500 [ 36%]  (Sampling) 
Chain 3 Iteration:  900 / 2500 [ 36%]  (Sampling) 
Chain 4 Iteration: 1000 / 2500 [ 40%]  (Sampling) 
Chain 1 Iteration: 1100 / 2500 [ 44%]  (Sampling) 
Chain 1 Iteration: 1200 / 2500 [ 48%]  (Sampling) 
Chain 2 Iteration: 1000 / 2500 [ 40%]  (Sampling) 
Chain 3 Iteration: 1000 / 2500 [ 40%]  (Sampling) 
Chain 3 Iteration: 1100 / 2500 [ 44%]  (Sampling) 
Chain 4 Iteration: 1100 / 2500 [ 44%]  (Sampling) 
Chain 1 Iteration: 1300 / 2500 [ 52%]  (Sampling) 
Chain 2 Iteration: 1100 / 2500 [ 44%]  (Sampling) 
Chain 3 Iteration: 1200 / 2500 [ 48%]  (Sampling) 
Chain 4 Iteration: 1200 / 2500 [ 48%]  (Sampling) 
Chain 1 Iteration: 1400 / 2500 [ 56%]  (Sampling) 
Chain 1 Iteration: 1500 / 2500 [ 60%]  (Sampling) 
Chain 2 Iteration: 1200 / 2500 [ 48%]  (Sampling) 
Chain 3 Iteration: 1300 / 2500 [ 52%]  (Sampling) 
Chain 4 Iteration: 1300 / 2500 [ 52%]  (Sampling) 
Chain 1 Iteration: 1600 / 2500 [ 64%]  (Sampling) 
Chain 2 Iteration: 1300 / 2500 [ 52%]  (Sampling) 
Chain 3 Iteration: 1400 / 2500 [ 56%]  (Sampling) 
Chain 3 Iteration: 1500 / 2500 [ 60%]  (Sampling) 
Chain 4 Iteration: 1400 / 2500 [ 56%]  (Sampling) 
Chain 1 Iteration: 1700 / 2500 [ 68%]  (Sampling) 
Chain 2 Iteration: 1400 / 2500 [ 56%]  (Sampling) 
Chain 3 Iteration: 1600 / 2500 [ 64%]  (Sampling) 
Chain 4 Iteration: 1500 / 2500 [ 60%]  (Sampling) 
Chain 1 Iteration: 1800 / 2500 [ 72%]  (Sampling) 
Chain 2 Iteration: 1500 / 2500 [ 60%]  (Sampling) 
Chain 3 Iteration: 1700 / 2500 [ 68%]  (Sampling) 
Chain 4 Iteration: 1600 / 2500 [ 64%]  (Sampling) 
Chain 1 Iteration: 1900 / 2500 [ 76%]  (Sampling) 
Chain 1 Iteration: 2000 / 2500 [ 80%]  (Sampling) 
Chain 2 Iteration: 1600 / 2500 [ 64%]  (Sampling) 
Chain 3 Iteration: 1800 / 2500 [ 72%]  (Sampling) 
Chain 4 Iteration: 1700 / 2500 [ 68%]  (Sampling) 
Chain 4 Iteration: 1800 / 2500 [ 72%]  (Sampling) 
Chain 1 Iteration: 2100 / 2500 [ 84%]  (Sampling) 
Chain 2 Iteration: 1700 / 2500 [ 68%]  (Sampling) 
Chain 3 Iteration: 1900 / 2500 [ 76%]  (Sampling) 
Chain 3 Iteration: 2000 / 2500 [ 80%]  (Sampling) 
Chain 4 Iteration: 1900 / 2500 [ 76%]  (Sampling) 
Chain 1 Iteration: 2200 / 2500 [ 88%]  (Sampling) 
Chain 1 Iteration: 2300 / 2500 [ 92%]  (Sampling) 
Chain 2 Iteration: 1800 / 2500 [ 72%]  (Sampling) 
Chain 3 Iteration: 2100 / 2500 [ 84%]  (Sampling) 
Chain 4 Iteration: 2000 / 2500 [ 80%]  (Sampling) 
Chain 1 Iteration: 2400 / 2500 [ 96%]  (Sampling) 
Chain 2 Iteration: 1900 / 2500 [ 76%]  (Sampling) 
Chain 2 Iteration: 2000 / 2500 [ 80%]  (Sampling) 
Chain 3 Iteration: 2200 / 2500 [ 88%]  (Sampling) 
Chain 4 Iteration: 2100 / 2500 [ 84%]  (Sampling) 
Chain 1 Iteration: 2500 / 2500 [100%]  (Sampling) 
Chain 2 Iteration: 2100 / 2500 [ 84%]  (Sampling) 
Chain 3 Iteration: 2300 / 2500 [ 92%]  (Sampling) 
Chain 3 Iteration: 2400 / 2500 [ 96%]  (Sampling) 
Chain 4 Iteration: 2200 / 2500 [ 88%]  (Sampling) 
Chain 1 finished in 2.2 seconds.
Chain 2 Iteration: 2200 / 2500 [ 88%]  (Sampling) 
Chain 3 Iteration: 2500 / 2500 [100%]  (Sampling) 
Chain 4 Iteration: 2300 / 2500 [ 92%]  (Sampling) 
Chain 3 finished in 2.3 seconds.
Chain 2 Iteration: 2300 / 2500 [ 92%]  (Sampling) 
Chain 4 Iteration: 2400 / 2500 [ 96%]  (Sampling) 
Chain 4 Iteration: 2500 / 2500 [100%]  (Sampling) 
Chain 4 finished in 2.4 seconds.
Chain 2 Iteration: 2400 / 2500 [ 96%]  (Sampling) 
Chain 2 Iteration: 2500 / 2500 [100%]  (Sampling) 
Chain 2 finished in 2.5 seconds.

All 4 chains finished successfully.
Mean chain execution time: 2.4 seconds.
Total execution time: 2.6 seconds.</code></pre>
</div>
</div>
<p>Vemos los parámetros estimados y sus intervalos de credibilidad y extraemos la posteriori</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(flbi)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              mean         sd         5.5%      94.5%    n_eff     Rhat4
m     -0.008692293 0.02258036 -0.044472871 0.02734239 6673.459 1.0005257
b      1.961391786 0.04356684  1.891207250 2.03241110 5380.781 0.9998034
a2     0.059745778 0.04370034 -0.009909845 0.12931849 5500.657 1.0000543
a1     0.026656585 0.03702030 -0.032118024 0.08601562 6410.710 0.9997482
tau    0.984889552 0.02213892  0.949803835 1.02046055 7752.122 1.0000469
sigma  0.967785086 0.02155725  0.933665955 1.00275110 8907.866 1.0001535
k      0.998568923 1.01036660  0.056543283 2.88207040 9005.060 1.0000657
p      0.482860133 0.01114257  0.465039000 0.50049459 8082.865 1.0000378</code></pre>
</div>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>post <span class="ot">&lt;-</span> <span class="fu">extract.samples</span>(flbi)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Pintamos la distribución a posteriori del efecto y cómo ya sabíamos, al no condicionar por el collider, se estima sin sesgo que no hay efecto causal de M a D.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(bayestestR<span class="sc">::</span><span class="fu">hdi</span>(post<span class="sc">$</span>m, <span class="at">ci =</span> <span class="fu">c</span>( <span class="fl">0.80</span>, <span class="fl">0.95</span>))) <span class="sc">+</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Estimación sin collider"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="index_files/figure-html/unnamed-chunk-15-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-3"><img src="index_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="modelo-condicionando-por-el-collider" class="level3">
<h3 class="anchored" data-anchor-id="modelo-condicionando-por-el-collider">Modelo condicionando por el collider</h3>
<p>Ya sabemos que no es necesario de hecho condicionar por el collider, más aún, que hacerlo induce un sesgo en la estimación del efecto, ¿pero qué pasa si estimamos el dag al completo?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">155</span>)</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>flbi_collider <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">alist</span>(</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># mom model</span></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>    M <span class="sc">~</span> <span class="fu">normal</span>( mu , sigma ),</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> a1 <span class="sc">+</span> b<span class="sc">*</span>B1 ,</span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># daughter model</span></span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>    D <span class="sc">~</span> <span class="fu">normal</span>( nu , tau ),</span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a>    nu <span class="ot">&lt;-</span> a2 <span class="sc">+</span> b<span class="sc">*</span>B2 <span class="sc">+</span> m<span class="sc">*</span>M ,</span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># B1 and B2</span></span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a>    B1 <span class="sc">~</span> <span class="fu">bernoulli</span>(p),</span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a>    B2 <span class="sc">~</span> <span class="fu">bernoulli</span>(p),</span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Collider</span></span>
<span id="cb49-16"><a href="#cb49-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb49-17"><a href="#cb49-17" aria-hidden="true" tabindex="-1"></a>     C <span class="sc">~</span> <span class="fu">normal</span>( cmu , csigma ),</span>
<span id="cb49-18"><a href="#cb49-18" aria-hidden="true" tabindex="-1"></a>     cmu <span class="ot">&lt;-</span> a3 <span class="sc">+</span> cm <span class="sc">*</span> M  <span class="sc">+</span> cd <span class="sc">*</span> D,</span>
<span id="cb49-19"><a href="#cb49-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-20"><a href="#cb49-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># priors</span></span>
<span id="cb49-21"><a href="#cb49-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(a1,a2,a3,b,m, cm, cd) <span class="sc">~</span> <span class="fu">normal</span>( <span class="dv">0</span> , <span class="fl">0.5</span> ),</span>
<span id="cb49-22"><a href="#cb49-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(sigma,tau, csigma) <span class="sc">~</span> <span class="fu">exponential</span>( <span class="dv">1</span> ),</span>
<span id="cb49-23"><a href="#cb49-23" aria-hidden="true" tabindex="-1"></a>    p <span class="sc">~</span> <span class="fu">beta</span>(<span class="dv">2</span>,<span class="dv">2</span>)</span>
<span id="cb49-24"><a href="#cb49-24" aria-hidden="true" tabindex="-1"></a>  ), <span class="at">data=</span>dat , <span class="at">chains=</span><span class="dv">4</span> , <span class="at">cores=</span><span class="dv">4</span> , <span class="at">warmup =</span> <span class="dv">500</span>, <span class="at">iter=</span><span class="dv">2500</span> , <span class="at">cmdstan=</span><span class="cn">TRUE</span> )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in '/tmp/Rtmpsdysi4/model-8eef4e4ce260.stan', line 3, column 4: Declaration
    of arrays by placing brackets after a variable name is deprecated and
    will be removed in Stan 2.32.0. Instead use the array keyword before the
    type. This can be changed automatically using the auto-format flag to
    stanc
Warning in '/tmp/Rtmpsdysi4/model-8eef4e4ce260.stan', line 4, column 4: Declaration
    of arrays by placing brackets after a variable name is deprecated and
    will be removed in Stan 2.32.0. Instead use the array keyword before the
    type. This can be changed automatically using the auto-format flag to
    stanc</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Running MCMC with 4 parallel chains, with 1 thread(s) per chain...

Chain 1 Iteration:    1 / 2500 [  0%]  (Warmup) 
Chain 2 Iteration:    1 / 2500 [  0%]  (Warmup) 
Chain 3 Iteration:    1 / 2500 [  0%]  (Warmup) 
Chain 4 Iteration:    1 / 2500 [  0%]  (Warmup) 
Chain 1 Iteration:  100 / 2500 [  4%]  (Warmup) 
Chain 2 Iteration:  100 / 2500 [  4%]  (Warmup) 
Chain 3 Iteration:  100 / 2500 [  4%]  (Warmup) 
Chain 4 Iteration:  100 / 2500 [  4%]  (Warmup) 
Chain 1 Iteration:  200 / 2500 [  8%]  (Warmup) 
Chain 2 Iteration:  200 / 2500 [  8%]  (Warmup) 
Chain 3 Iteration:  200 / 2500 [  8%]  (Warmup) 
Chain 4 Iteration:  200 / 2500 [  8%]  (Warmup) 
Chain 1 Iteration:  300 / 2500 [ 12%]  (Warmup) 
Chain 2 Iteration:  300 / 2500 [ 12%]  (Warmup) 
Chain 3 Iteration:  300 / 2500 [ 12%]  (Warmup) 
Chain 4 Iteration:  300 / 2500 [ 12%]  (Warmup) 
Chain 1 Iteration:  400 / 2500 [ 16%]  (Warmup) 
Chain 2 Iteration:  400 / 2500 [ 16%]  (Warmup) 
Chain 3 Iteration:  400 / 2500 [ 16%]  (Warmup) 
Chain 4 Iteration:  400 / 2500 [ 16%]  (Warmup) 
Chain 3 Iteration:  500 / 2500 [ 20%]  (Warmup) 
Chain 3 Iteration:  501 / 2500 [ 20%]  (Sampling) 
Chain 1 Iteration:  500 / 2500 [ 20%]  (Warmup) 
Chain 1 Iteration:  501 / 2500 [ 20%]  (Sampling) 
Chain 2 Iteration:  500 / 2500 [ 20%]  (Warmup) 
Chain 2 Iteration:  501 / 2500 [ 20%]  (Sampling) 
Chain 4 Iteration:  500 / 2500 [ 20%]  (Warmup) 
Chain 4 Iteration:  501 / 2500 [ 20%]  (Sampling) 
Chain 3 Iteration:  600 / 2500 [ 24%]  (Sampling) 
Chain 4 Iteration:  600 / 2500 [ 24%]  (Sampling) 
Chain 1 Iteration:  600 / 2500 [ 24%]  (Sampling) 
Chain 2 Iteration:  600 / 2500 [ 24%]  (Sampling) 
Chain 1 Iteration:  700 / 2500 [ 28%]  (Sampling) 
Chain 3 Iteration:  700 / 2500 [ 28%]  (Sampling) 
Chain 4 Iteration:  700 / 2500 [ 28%]  (Sampling) 
Chain 2 Iteration:  700 / 2500 [ 28%]  (Sampling) 
Chain 1 Iteration:  800 / 2500 [ 32%]  (Sampling) 
Chain 2 Iteration:  800 / 2500 [ 32%]  (Sampling) 
Chain 3 Iteration:  800 / 2500 [ 32%]  (Sampling) 
Chain 4 Iteration:  800 / 2500 [ 32%]  (Sampling) 
Chain 1 Iteration:  900 / 2500 [ 36%]  (Sampling) 
Chain 2 Iteration:  900 / 2500 [ 36%]  (Sampling) 
Chain 3 Iteration:  900 / 2500 [ 36%]  (Sampling) 
Chain 4 Iteration:  900 / 2500 [ 36%]  (Sampling) 
Chain 1 Iteration: 1000 / 2500 [ 40%]  (Sampling) 
Chain 3 Iteration: 1000 / 2500 [ 40%]  (Sampling) 
Chain 4 Iteration: 1000 / 2500 [ 40%]  (Sampling) 
Chain 2 Iteration: 1000 / 2500 [ 40%]  (Sampling) 
Chain 1 Iteration: 1100 / 2500 [ 44%]  (Sampling) 
Chain 3 Iteration: 1100 / 2500 [ 44%]  (Sampling) 
Chain 4 Iteration: 1100 / 2500 [ 44%]  (Sampling) 
Chain 2 Iteration: 1100 / 2500 [ 44%]  (Sampling) 
Chain 1 Iteration: 1200 / 2500 [ 48%]  (Sampling) 
Chain 2 Iteration: 1200 / 2500 [ 48%]  (Sampling) 
Chain 3 Iteration: 1200 / 2500 [ 48%]  (Sampling) 
Chain 4 Iteration: 1200 / 2500 [ 48%]  (Sampling) 
Chain 4 Iteration: 1300 / 2500 [ 52%]  (Sampling) 
Chain 1 Iteration: 1300 / 2500 [ 52%]  (Sampling) 
Chain 2 Iteration: 1300 / 2500 [ 52%]  (Sampling) 
Chain 3 Iteration: 1300 / 2500 [ 52%]  (Sampling) 
Chain 1 Iteration: 1400 / 2500 [ 56%]  (Sampling) 
Chain 3 Iteration: 1400 / 2500 [ 56%]  (Sampling) 
Chain 4 Iteration: 1400 / 2500 [ 56%]  (Sampling) 
Chain 2 Iteration: 1400 / 2500 [ 56%]  (Sampling) 
Chain 1 Iteration: 1500 / 2500 [ 60%]  (Sampling) 
Chain 2 Iteration: 1500 / 2500 [ 60%]  (Sampling) 
Chain 3 Iteration: 1500 / 2500 [ 60%]  (Sampling) 
Chain 4 Iteration: 1500 / 2500 [ 60%]  (Sampling) 
Chain 4 Iteration: 1600 / 2500 [ 64%]  (Sampling) 
Chain 1 Iteration: 1600 / 2500 [ 64%]  (Sampling) 
Chain 2 Iteration: 1600 / 2500 [ 64%]  (Sampling) 
Chain 3 Iteration: 1600 / 2500 [ 64%]  (Sampling) 
Chain 1 Iteration: 1700 / 2500 [ 68%]  (Sampling) 
Chain 4 Iteration: 1700 / 2500 [ 68%]  (Sampling) 
Chain 2 Iteration: 1700 / 2500 [ 68%]  (Sampling) 
Chain 3 Iteration: 1700 / 2500 [ 68%]  (Sampling) 
Chain 1 Iteration: 1800 / 2500 [ 72%]  (Sampling) 
Chain 3 Iteration: 1800 / 2500 [ 72%]  (Sampling) 
Chain 4 Iteration: 1800 / 2500 [ 72%]  (Sampling) 
Chain 2 Iteration: 1800 / 2500 [ 72%]  (Sampling) 
Chain 4 Iteration: 1900 / 2500 [ 76%]  (Sampling) 
Chain 1 Iteration: 1900 / 2500 [ 76%]  (Sampling) 
Chain 2 Iteration: 1900 / 2500 [ 76%]  (Sampling) 
Chain 3 Iteration: 1900 / 2500 [ 76%]  (Sampling) 
Chain 4 Iteration: 2000 / 2500 [ 80%]  (Sampling) 
Chain 1 Iteration: 2000 / 2500 [ 80%]  (Sampling) 
Chain 2 Iteration: 2000 / 2500 [ 80%]  (Sampling) 
Chain 3 Iteration: 2000 / 2500 [ 80%]  (Sampling) 
Chain 4 Iteration: 2100 / 2500 [ 84%]  (Sampling) 
Chain 1 Iteration: 2100 / 2500 [ 84%]  (Sampling) 
Chain 2 Iteration: 2100 / 2500 [ 84%]  (Sampling) 
Chain 3 Iteration: 2100 / 2500 [ 84%]  (Sampling) 
Chain 4 Iteration: 2200 / 2500 [ 88%]  (Sampling) 
Chain 1 Iteration: 2200 / 2500 [ 88%]  (Sampling) 
Chain 3 Iteration: 2200 / 2500 [ 88%]  (Sampling) 
Chain 2 Iteration: 2200 / 2500 [ 88%]  (Sampling) 
Chain 4 Iteration: 2300 / 2500 [ 92%]  (Sampling) 
Chain 1 Iteration: 2300 / 2500 [ 92%]  (Sampling) 
Chain 2 Iteration: 2300 / 2500 [ 92%]  (Sampling) 
Chain 3 Iteration: 2300 / 2500 [ 92%]  (Sampling) 
Chain 4 Iteration: 2400 / 2500 [ 96%]  (Sampling) 
Chain 1 Iteration: 2400 / 2500 [ 96%]  (Sampling) 
Chain 2 Iteration: 2400 / 2500 [ 96%]  (Sampling) 
Chain 3 Iteration: 2400 / 2500 [ 96%]  (Sampling) 
Chain 4 Iteration: 2500 / 2500 [100%]  (Sampling) 
Chain 4 finished in 4.4 seconds.
Chain 1 Iteration: 2500 / 2500 [100%]  (Sampling) 
Chain 1 finished in 4.5 seconds.
Chain 2 Iteration: 2500 / 2500 [100%]  (Sampling) 
Chain 3 Iteration: 2500 / 2500 [100%]  (Sampling) 
Chain 2 finished in 4.5 seconds.
Chain 3 finished in 4.5 seconds.

All 4 chains finished successfully.
Mean chain execution time: 4.5 seconds.
Total execution time: 4.6 seconds.</code></pre>
</div>
</div>
<p>Viendo la distribución posterior de los parámetros resulta que hemos podido estimar el verdadero efecto causal de M sobre D (que sabemos que es 0), incluso aunque hayamos “condicionado” por el collider.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(flbi_collider)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>               mean         sd        5.5%      94.5%     n_eff     Rhat4
cd      3.968243739 0.04611450  3.89560945 4.04327110  8248.105 1.0004150
cm      2.934145831 0.04687289  2.85989505 3.00919165  8890.321 1.0001715
m      -0.009309562 0.02249104 -0.04553421 0.02674973  8503.878 1.0000069
b       1.962677924 0.04345328  1.89429945 2.03282660  7107.343 0.9999206
a3      0.160077627 0.09126337  0.01252729 0.30475624  7756.140 1.0006626
a2      0.060140941 0.04359355 -0.01003761 0.13036986  7499.209 0.9996584
a1      0.025057624 0.03711509 -0.03519740 0.08448685  7396.713 1.0005212
csigma  2.064163930 0.04708394  1.99060945 2.14121220 10185.107 1.0002583
tau     0.984744502 0.02189981  0.95050602 1.01991110  8571.627 0.9998603
sigma   0.968314337 0.02180198  0.93405345 1.00380110  9457.782 1.0001085
p       0.482931190 0.01117531  0.46538884 0.50083727 10342.731 0.9998451</code></pre>
</div>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>post_with_collider <span class="ot">&lt;-</span> <span class="fu">extract.samples</span>(flbi_collider)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">quantile</span>(post_with_collider<span class="sc">$</span>m)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          0%          25%          50%          75%         100% 
-0.095140500 -0.024429525 -0.009353655  0.005972277  0.072001900 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(bayestestR<span class="sc">::</span><span class="fu">hdi</span>(post_with_collider<span class="sc">$</span>m, <span class="at">ci =</span> <span class="fu">c</span>( <span class="fl">0.80</span>, <span class="fl">0.95</span>))) <span class="sc">+</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Estimación con collider"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="index_files/figure-html/unnamed-chunk-18-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-4"><img src="index_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>Así, que siendo “pluralista”, estimar el dag completo nos puede ayudar en situaciones dónde el backdoor criterio nos diga que no se puede estimar el efecto causal.</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<script src="https://giscus.app/client.js" data-repo="joscani/blogComments" data-repo-id="R_kgDOIXA9wA" data-category="General" data-category-id="DIC_kwDOIXA9wM4CSZhs" data-mapping="title" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="light" data-lang="en" crossorigin="anonymous" async="">
</script>
</div> <!-- /content -->
<script>var lightboxQuarto = GLightbox({"closeEffect":"zoom","descPosition":"bottom","loop":true,"selector":".lightbox","openEffect":"zoom"});</script>



</body></html>