{
  "hash": "09761fc3722313f70b1ffe67d8b420a3",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle:  Meta-análisis. Agregando encuestas II\ndate: '2024-06-08'\ncategories: \n  - 2024\n  - muestreo\n  - encuestas electorales\n  - análisis bayesiano\ndescription: ''\nexecute: \n  message: false\n  warning: false\n  echo: true\nformat: \n  html: \n    fig-height: 5\n    fig-dpi: 300\n    fig-width: 8\n    fig-align: center\n    code-fold: show\n    code-summary: \"Show the code\"\nimage: agregando_encuestas.png\nknitr:\n  opts_chunk:\n    out.width: 80%\n    fig.showtext: TRUE\n    collapse: true\n    comment: \"#>\"\n---\n\n\n::: callout-note\n## Listening\n\n<iframe style=\"border-radius:12px\" src=\"https://open.spotify.com/embed/track/3RarI3aibhHVM8CgOGE1Ou?utm_source=generator\" width=\"100%\" height=\"250\" frameBorder=\"0\" allowfullscreen allow=\"autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture\" loading=\"lazy\">\n\n</iframe>\n\n\n:::\n\n\n\n## Introducción\n\nSupongo que se trata de reminiscencias de los tiempos en que curraba en Córdoba, con mi jefe y amigo \"el Truji\", \npero de vez en cuando me gusta asomarme a las encuestas de estimación de voto. \n\n\nYa en algunos post anteriores como en este de [cocinando](https://muestrear-no-es-pecado.netlify.app/2022/01/01/cocinando/) contaba de manera simple algunas de \nlas _recetas_ que se usan para la estimación de voto, básicamente contaba temas de post-estratificación utilizando información auxiliar. \n\nMás recientemente en [Meta-análisis. Agregando encuestas](https://muestrear-no-es-pecado.netlify.app/2023/metanalisis) hacía un ejercicio de como agregar diferentes encuestas para las elecciones generales de Julio. Y como este finde ando un poco febril por vete tú a saber qué bicho, pues he decidido repetir el ejercicio de meta-análisis para las elecciones europeas de mañana. \n\n\nAsí que se aplica toda la literatura que puse en el post de julio de 2023 y por lo tanto voy a poner más código que otra cosa.\n\n\n## Datos\n\nLos datos que necesito para este ejercicio son simples. A saber.\n\n* Nombre de la empresa encuestadora: Será un efecto aleatorio\n* Tamaño de muestra de la encuesta: No todas lo dan\n* Estimación porcentual a cada partido que dan.\n* Fecha de publicación de la encuesta: Lo usaré para tener en cuenta la tendencia temporal\n\nA partir del n de cada encuesta y de la estimación porcentual a cada partido obtengo grosso modo el número de \nencuestados que dice que va a votar a cada partido en cada encuesta.  Con estos datos ya puedo hacer un modelo multinomial bayesiano que me sirva como agregador de encuestas. Vamos al lío\n\nLos datos los he sacado de la wikipedia, [aqui](https://en.wikipedia.org/wiki/Opinion_polling_and_seat_projections_for_the_2024_European_Parliament_election) tal y como amablemente me sugirió Kiko Llaneras. \n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\n# no sé pq lo tenia separado por ; y con , como decimal\ndf <-  read_csv2(here::here(\"2024/06/european_polls_spain.csv\")) |> \n    select(empresa, fecha, everything())\n```\n:::\n\n\nLo vemos en forma de tabla html, son unas 31 encuestas\n\n\n::: {.cell}\n\n```{.r .cell-code}\nDT::datatable(df)\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"datatables html-widget html-fill-item\" id=\"htmlwidget-88cb8743b358a2b0293f\" style=\"width:100%;height:auto;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-88cb8743b358a2b0293f\">{\"x\":{\"filter\":\"none\",\"vertical\":false,\"data\":[[\"1\",\"2\",\"3\",\"4\",\"5\",\"6\",\"7\",\"8\",\"9\",\"10\",\"11\",\"12\",\"13\",\"14\",\"15\",\"16\",\"17\",\"18\",\"19\",\"20\",\"21\",\"22\",\"23\",\"24\",\"25\",\"26\",\"27\",\"28\",\"29\",\"30\",\"31\"],[\"data10\",\"electopanel\",\"sigmados\",\"sociometrica\",\"cluster17\",\"targetpoint\",\"gesop\",\"nc_report\",\"electopanel\",\"sigmados\",\"hamalgama\",\"40db\",\"gad3\",\"cis\",\"metroscopia\",\"celestetel\",\"sociometrica\",\"data10\",\"gad3\",\"nc_report\",\"sigmados\",\"cluster17\",\"sociometrica\",\"nc_report\",\"40db\",\"simplelogica\",\"sigmados\",\"sociometrica\",\"gad3\",\"sigmados\",\"sociometrica\"],[\"2024-06-03\",\"2024-06-03\",\"2024-06-03\",\"2024-06-03\",\"2024-05-31\",\"2024-05-31\",\"2024-05-31\",\"2024-05-31\",\"2024-05-31\",\"2024-05-31\",\"2024-05-31\",\"2024-05-30\",\"2024-05-30\",\"2024-05-30\",\"2024-05-29\",\"2024-05-28\",\"2024-05-28\",\"2024-05-24\",\"2024-05-24\",\"2024-05-24\",\"2024-05-24\",\"2024-05-23\",\"2024-05-19\",\"2024-05-17\",\"2024-05-13\",\"2024-05-09\",\"2024-04-30\",\"2024-04-12\",\"2024-03-21\",\"2023-12-26\",\"2023-11-24\"],[\"okdiario\",\"electomania\",\"elmundo\",\"elespañol\",\"agendapublica\",\"eldebate\",\"prensa_iberica\",\"la_razon\",\"electomania\",\"elmundo\",\"vozpopuli\",\"prisa\",\"abc\",\"cis\",\"metroscopia\",\"ondacero\",\"elespañol\",\"okdiario\",\"mediaset\",\"la_razon\",\"elmundo\",\"agendapublica\",\"elespañol\",\"la_razon\",\"prisa\",\"eldiario\",\"elmundo\",\"elespañol\",\"abc\",\"elmundo\",\"elespañol\"],[1500,1422,3535,630,2060,1003,630,1000,3109,3948,1000,2000,1005,7491,1000,1100,503,1500,1002,1000,2137,1640,519,1000,2000,1131,2120,2550,1017,2992,2109],[30.2,30.2,30.3,29.3,29.5,31,31.5,29.2,30,29.7,29.6,30.1,29.8,32,29.5,29.3,29.4,29.6,31.4,27.9,30.2,28.7,28.8,27.2,30.1,29.9,28.9,26.3,26.5,29.2,29.2],[34.4,32.9,33.2,34.1,33.8,33.5,32,35,33.5,32.7,35.1,33.2,34.9,29.5,33.5,34.9,34.8,35.4,34.5,36.1,35.1,34.1,36.9,36.3,33.5,36.4,35.7,38.1,37.8,38.1,36.8],[1,0.8,0,0.9,0,0,0.9,0,0.8,0.8,0.9,1,0,1,0.8,1,1.4,0.9,0.7,0,0.8,0,0.9,0,1.1,0,0.8,1.7,0.3,0.2,1.1],[3.9,3.6,4.1,3.7,3.5,3.9,4.4,3.6,3.3,4,3.5,4,3.5,3.7,3.6,3.6,3.3,2.9,3,3,3.6,3.4,3.2,2.8,4,2,3.1,2.4,3.5,2.6,2],[10.3,9.5,10.5,10.1,10.3,8.9,8.1,9.9,9.199999999999999,11,10.2,10.7,9.699999999999999,10.1,10.1,9.9,10.7,10.4,9.300000000000001,9,9.699999999999999,9.6,10.4,9.4,12.6,10.9,11.9,10.9,9.199999999999999,11.8,10.2],[4.4,4.2,4.3,3.8,4.5,4.5,5,4.9,4.5,3.8,4.5,4.8,4.8,4,4.7,4.8,4.5,4.7,4.5,5.2,3.6,4.5,5.1,4.9,4.6,4.8,4.1,6.1,4.4,2.8,4.2],[2.5,2.5,1.9,2.8,2.6,2.4,2,2.8,2.5,1.9,2.5,2.1,2.4,1.6,2.3,2.6,2.7,2.5,2.4,2.9,2.4,2.6,2.4,2.7,2.2,2.2,2,2.6,2.7,2.3,5.1],[1.6,1.7,1.4,1.6,1.7,0,1.8,1.9,2,1.3,0,1.4,1.9,1.2,1.8,1.8,1.4,1.7,1.5,2.2,1.3,1.9,1.3,2.1,1.9,1.1,1.8,1.8,2.4,2,1.3],[0,1.2,0,0,0,0,0,0,1.3,0,0,0,0,0,0,1.1,0,0,0,0,0,1.3,0,0,0,0,0,0,0,0,0],[6.2,5.9,6,6.3,5.9,6,5.8,6.4,6.3,6.9,6.3,5.6,5.9,6,5.9,6.3,6.3,6.4,5.7,6.8,7,6.7,7,7.7,5.7,8,9.5,6.7,7.2,10.1,8],[0,2.5,3.4,2.7,2.3,2.9,3.7,2.2,2,3.5,2,2.5,2.4,5.2,3.1,1.9,2,0,2.7,1.2,2.6,2.2,0.8,1.4,0,0,0,0,0,0,0],[94.5,95,95.09999999999999,95.3,94.09999999999999,93.09999999999999,95.2,95.90000000000001,95.40000000000001,95.59999999999999,94.59999999999999,95.40000000000001,95.3,94.3,95.3,97.2,96.5,94.5,95.7,94.3,96.3,95,96.8,94.5,95.7,95.3,97.8,96.59999999999999,94,99.09999999999999,97.90000000000001],[5.5,5,4.89999999999999,4.7,5.90000000000001,6.90000000000001,4.8,4.09999999999999,4.59999999999999,4.39999999999999,5.39999999999999,4.59999999999999,4.7,5.7,4.7,2.8,3.5,5.5,4.3,5.7,3.7,5,3.2,5.5,4.3,4.7,2.2,3.39999999999999,6,0.900000000000006,2.10000000000001]],\"container\":\"<table class=\\\"display\\\">\\n  <thead>\\n    <tr>\\n      <th> <\\/th>\\n      <th>empresa<\\/th>\\n      <th>fecha<\\/th>\\n      <th>medio<\\/th>\\n      <th>n<\\/th>\\n      <th>psoe<\\/th>\\n      <th>pp<\\/th>\\n      <th>ciudadanos<\\/th>\\n      <th>podemos<\\/th>\\n      <th>vox<\\/th>\\n      <th>ar<\\/th>\\n      <th>junts<\\/th>\\n      <th>europa_solidaria<\\/th>\\n      <th>pacma<\\/th>\\n      <th>sumar<\\/th>\\n      <th>salf<\\/th>\\n      <th>Tot_pct<\\/th>\\n      <th>resto<\\/th>\\n    <\\/tr>\\n  <\\/thead>\\n<\\/table>\",\"options\":{\"columnDefs\":[{\"className\":\"dt-right\",\"targets\":[4,5,6,7,8,9,10,11,12,13,14,15,16,17]},{\"orderable\":false,\"targets\":0},{\"name\":\" \",\"targets\":0},{\"name\":\"empresa\",\"targets\":1},{\"name\":\"fecha\",\"targets\":2},{\"name\":\"medio\",\"targets\":3},{\"name\":\"n\",\"targets\":4},{\"name\":\"psoe\",\"targets\":5},{\"name\":\"pp\",\"targets\":6},{\"name\":\"ciudadanos\",\"targets\":7},{\"name\":\"podemos\",\"targets\":8},{\"name\":\"vox\",\"targets\":9},{\"name\":\"ar\",\"targets\":10},{\"name\":\"junts\",\"targets\":11},{\"name\":\"europa_solidaria\",\"targets\":12},{\"name\":\"pacma\",\"targets\":13},{\"name\":\"sumar\",\"targets\":14},{\"name\":\"salf\",\"targets\":15},{\"name\":\"Tot_pct\",\"targets\":16},{\"name\":\"resto\",\"targets\":17}],\"order\":[],\"autoWidth\":false,\"orderClasses\":false}},\"evals\":[],\"jsHooks\":[]}</script>\n```\n\n:::\n:::\n\n\nPara quien no lo sepa hay algunas coaliciones curiosas. \n* AR: Ahora república. Están ERC y el BNG por ejemplo\n* Europa Solidaria: Dónde está el pnv\n* Salf: Se acabó la fiesta, el partido de Alvise que  las encuestas más recientes lo están teniendo en cuenta\n\n\n\nVamos a tratar un poco los datos. \n\nAl pacma  lo voy a meter junto con \"resto\". Este es mi blog y aquí no impera la democracia, se siente. \n\nTambién calculo una columna `time` que indica los días que faltaban para las elecciones desde la fecha de publicación.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n\ndf_new <- df |> \n  mutate(resto = resto + pacma) |> \n  select(-pacma, - Tot_pct) |> \n  pivot_longer(c(psoe, pp, ciudadanos, podemos, vox, ar, junts, europa_solidaria, \n                 sumar, salf, resto)) |> \n  mutate(votos = n * value / 100) |> \n  rename(partido = name, \n         estim = value) |> \n  mutate( \n    time = fecha - ymd(\"2024-06-09\")\n        ) \n\nDT::datatable(df_new)\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"datatables html-widget html-fill-item\" id=\"htmlwidget-0c3e10419382328a899b\" style=\"width:100%;height:auto;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-0c3e10419382328a899b\">{\"x\":{\"filter\":\"none\",\"vertical\":false,\"data\":[[\"1\",\"2\",\"3\",\"4\",\"5\",\"6\",\"7\",\"8\",\"9\",\"10\",\"11\",\"12\",\"13\",\"14\",\"15\",\"16\",\"17\",\"18\",\"19\",\"20\",\"21\",\"22\",\"23\",\"24\",\"25\",\"26\",\"27\",\"28\",\"29\",\"30\",\"31\",\"32\",\"33\",\"34\",\"35\",\"36\",\"37\",\"38\",\"39\",\"40\",\"41\",\"42\",\"43\",\"44\",\"45\",\"46\",\"47\",\"48\",\"49\",\"50\",\"51\",\"52\",\"53\",\"54\",\"55\",\"56\",\"57\",\"58\",\"59\",\"60\",\"61\",\"62\",\"63\",\"64\",\"65\",\"66\",\"67\",\"68\",\"69\",\"70\",\"71\",\"72\",\"73\",\"74\",\"75\",\"76\",\"77\",\"78\",\"79\",\"80\",\"81\",\"82\",\"83\",\"84\",\"85\",\"86\",\"87\",\"88\",\"89\",\"90\",\"91\",\"92\",\"93\",\"94\",\"95\",\"96\",\"97\",\"98\",\"99\",\"100\",\"101\",\"102\",\"103\",\"104\",\"105\",\"106\",\"107\",\"108\",\"109\",\"110\",\"111\",\"112\",\"113\",\"114\",\"115\",\"116\",\"117\",\"118\",\"119\",\"120\",\"121\",\"122\",\"123\",\"124\",\"125\",\"126\",\"127\",\"128\",\"129\",\"130\",\"131\",\"132\",\"133\",\"134\",\"135\",\"136\",\"137\",\"138\",\"139\",\"140\",\"141\",\"142\",\"143\",\"144\",\"145\",\"146\",\"147\",\"148\",\"149\",\"150\",\"151\",\"152\",\"153\",\"154\",\"155\",\"156\",\"157\",\"158\",\"159\",\"160\",\"161\",\"162\",\"163\",\"164\",\"165\",\"166\",\"167\",\"168\",\"169\",\"170\",\"171\",\"172\",\"173\",\"174\",\"175\",\"176\",\"177\",\"178\",\"179\",\"180\",\"181\",\"182\",\"183\",\"184\",\"185\",\"186\",\"187\",\"188\",\"189\",\"190\",\"191\",\"192\",\"193\",\"194\",\"195\",\"196\",\"197\",\"198\",\"199\",\"200\",\"201\",\"202\",\"203\",\"204\",\"205\",\"206\",\"207\",\"208\",\"209\",\"210\",\"211\",\"212\",\"213\",\"214\",\"215\",\"216\",\"217\",\"218\",\"219\",\"220\",\"221\",\"222\",\"223\",\"224\",\"225\",\"226\",\"227\",\"228\",\"229\",\"230\",\"231\",\"232\",\"233\",\"234\",\"235\",\"236\",\"237\",\"238\",\"239\",\"240\",\"241\",\"242\",\"243\",\"244\",\"245\",\"246\",\"247\",\"248\",\"249\",\"250\",\"251\",\"252\",\"253\",\"254\",\"255\",\"256\",\"257\",\"258\",\"259\",\"260\",\"261\",\"262\",\"263\",\"264\",\"265\",\"266\",\"267\",\"268\",\"269\",\"270\",\"271\",\"272\",\"273\",\"274\",\"275\",\"276\",\"277\",\"278\",\"279\",\"280\",\"281\",\"282\",\"283\",\"284\",\"285\",\"286\",\"287\",\"288\",\"289\",\"290\",\"291\",\"292\",\"293\",\"294\",\"295\",\"296\",\"297\",\"298\",\"299\",\"300\",\"301\",\"302\",\"303\",\"304\",\"305\",\"306\",\"307\",\"308\",\"309\",\"310\",\"311\",\"312\",\"313\",\"314\",\"315\",\"316\",\"317\",\"318\",\"319\",\"320\",\"321\",\"322\",\"323\",\"324\",\"325\",\"326\",\"327\",\"328\",\"329\",\"330\",\"331\",\"332\",\"333\",\"334\",\"335\",\"336\",\"337\",\"338\",\"339\",\"340\",\"341\"],[\"data10\",\"data10\",\"data10\",\"data10\",\"data10\",\"data10\",\"data10\",\"data10\",\"data10\",\"data10\",\"data10\",\"electopanel\",\"electopanel\",\"electopanel\",\"electopanel\",\"electopanel\",\"electopanel\",\"electopanel\",\"electopanel\",\"electopanel\",\"electopanel\",\"electopanel\",\"sigmados\",\"sigmados\",\"sigmados\",\"sigmados\",\"sigmados\",\"sigmados\",\"sigmados\",\"sigmados\",\"sigmados\",\"sigmados\",\"sigmados\",\"sociometrica\",\"sociometrica\",\"sociometrica\",\"sociometrica\",\"sociometrica\",\"sociometrica\",\"sociometrica\",\"sociometrica\",\"sociometrica\",\"sociometrica\",\"sociometrica\",\"cluster17\",\"cluster17\",\"cluster17\",\"cluster17\",\"cluster17\",\"cluster17\",\"cluster17\",\"cluster17\",\"cluster17\",\"cluster17\",\"cluster17\",\"targetpoint\",\"targetpoint\",\"targetpoint\",\"targetpoint\",\"targetpoint\",\"targetpoint\",\"targetpoint\",\"targetpoint\",\"targetpoint\",\"targetpoint\",\"targetpoint\",\"gesop\",\"gesop\",\"gesop\",\"gesop\",\"gesop\",\"gesop\",\"gesop\",\"gesop\",\"gesop\",\"gesop\",\"gesop\",\"nc_report\",\"nc_report\",\"nc_report\",\"nc_report\",\"nc_report\",\"nc_report\",\"nc_report\",\"nc_report\",\"nc_report\",\"nc_report\",\"nc_report\",\"electopanel\",\"electopanel\",\"electopanel\",\"electopanel\",\"electopanel\",\"electopanel\",\"electopanel\",\"electopanel\",\"electopanel\",\"electopanel\",\"electopanel\",\"sigmados\",\"sigmados\",\"sigmados\",\"sigmados\",\"sigmados\",\"sigmados\",\"sigmados\",\"sigmados\",\"sigmados\",\"sigmados\",\"sigmados\",\"hamalgama\",\"hamalgama\",\"hamalgama\",\"hamalgama\",\"hamalgama\",\"hamalgama\",\"hamalgama\",\"hamalgama\",\"hamalgama\",\"hamalgama\",\"hamalgama\",\"40db\",\"40db\",\"40db\",\"40db\",\"40db\",\"40db\",\"40db\",\"40db\",\"40db\",\"40db\",\"40db\",\"gad3\",\"gad3\",\"gad3\",\"gad3\",\"gad3\",\"gad3\",\"gad3\",\"gad3\",\"gad3\",\"gad3\",\"gad3\",\"cis\",\"cis\",\"cis\",\"cis\",\"cis\",\"cis\",\"cis\",\"cis\",\"cis\",\"cis\",\"cis\",\"metroscopia\",\"metroscopia\",\"metroscopia\",\"metroscopia\",\"metroscopia\",\"metroscopia\",\"metroscopia\",\"metroscopia\",\"metroscopia\",\"metroscopia\",\"metroscopia\",\"celestetel\",\"celestetel\",\"celestetel\",\"celestetel\",\"celestetel\",\"celestetel\",\"celestetel\",\"celestetel\",\"celestetel\",\"celestetel\",\"celestetel\",\"sociometrica\",\"sociometrica\",\"sociometrica\",\"sociometrica\",\"sociometrica\",\"sociometrica\",\"sociometrica\",\"sociometrica\",\"sociometrica\",\"sociometrica\",\"sociometrica\",\"data10\",\"data10\",\"data10\",\"data10\",\"data10\",\"data10\",\"data10\",\"data10\",\"data10\",\"data10\",\"data10\",\"gad3\",\"gad3\",\"gad3\",\"gad3\",\"gad3\",\"gad3\",\"gad3\",\"gad3\",\"gad3\",\"gad3\",\"gad3\",\"nc_report\",\"nc_report\",\"nc_report\",\"nc_report\",\"nc_report\",\"nc_report\",\"nc_report\",\"nc_report\",\"nc_report\",\"nc_report\",\"nc_report\",\"sigmados\",\"sigmados\",\"sigmados\",\"sigmados\",\"sigmados\",\"sigmados\",\"sigmados\",\"sigmados\",\"sigmados\",\"sigmados\",\"sigmados\",\"cluster17\",\"cluster17\",\"cluster17\",\"cluster17\",\"cluster17\",\"cluster17\",\"cluster17\",\"cluster17\",\"cluster17\",\"cluster17\",\"cluster17\",\"sociometrica\",\"sociometrica\",\"sociometrica\",\"sociometrica\",\"sociometrica\",\"sociometrica\",\"sociometrica\",\"sociometrica\",\"sociometrica\",\"sociometrica\",\"sociometrica\",\"nc_report\",\"nc_report\",\"nc_report\",\"nc_report\",\"nc_report\",\"nc_report\",\"nc_report\",\"nc_report\",\"nc_report\",\"nc_report\",\"nc_report\",\"40db\",\"40db\",\"40db\",\"40db\",\"40db\",\"40db\",\"40db\",\"40db\",\"40db\",\"40db\",\"40db\",\"simplelogica\",\"simplelogica\",\"simplelogica\",\"simplelogica\",\"simplelogica\",\"simplelogica\",\"simplelogica\",\"simplelogica\",\"simplelogica\",\"simplelogica\",\"simplelogica\",\"sigmados\",\"sigmados\",\"sigmados\",\"sigmados\",\"sigmados\",\"sigmados\",\"sigmados\",\"sigmados\",\"sigmados\",\"sigmados\",\"sigmados\",\"sociometrica\",\"sociometrica\",\"sociometrica\",\"sociometrica\",\"sociometrica\",\"sociometrica\",\"sociometrica\",\"sociometrica\",\"sociometrica\",\"sociometrica\",\"sociometrica\",\"gad3\",\"gad3\",\"gad3\",\"gad3\",\"gad3\",\"gad3\",\"gad3\",\"gad3\",\"gad3\",\"gad3\",\"gad3\",\"sigmados\",\"sigmados\",\"sigmados\",\"sigmados\",\"sigmados\",\"sigmados\",\"sigmados\",\"sigmados\",\"sigmados\",\"sigmados\",\"sigmados\",\"sociometrica\",\"sociometrica\",\"sociometrica\",\"sociometrica\",\"sociometrica\",\"sociometrica\",\"sociometrica\",\"sociometrica\",\"sociometrica\",\"sociometrica\",\"sociometrica\"],[\"2024-06-03\",\"2024-06-03\",\"2024-06-03\",\"2024-06-03\",\"2024-06-03\",\"2024-06-03\",\"2024-06-03\",\"2024-06-03\",\"2024-06-03\",\"2024-06-03\",\"2024-06-03\",\"2024-06-03\",\"2024-06-03\",\"2024-06-03\",\"2024-06-03\",\"2024-06-03\",\"2024-06-03\",\"2024-06-03\",\"2024-06-03\",\"2024-06-03\",\"2024-06-03\",\"2024-06-03\",\"2024-06-03\",\"2024-06-03\",\"2024-06-03\",\"2024-06-03\",\"2024-06-03\",\"2024-06-03\",\"2024-06-03\",\"2024-06-03\",\"2024-06-03\",\"2024-06-03\",\"2024-06-03\",\"2024-06-03\",\"2024-06-03\",\"2024-06-03\",\"2024-06-03\",\"2024-06-03\",\"2024-06-03\",\"2024-06-03\",\"2024-06-03\",\"2024-06-03\",\"2024-06-03\",\"2024-06-03\",\"2024-05-31\",\"2024-05-31\",\"2024-05-31\",\"2024-05-31\",\"2024-05-31\",\"2024-05-31\",\"2024-05-31\",\"2024-05-31\",\"2024-05-31\",\"2024-05-31\",\"2024-05-31\",\"2024-05-31\",\"2024-05-31\",\"2024-05-31\",\"2024-05-31\",\"2024-05-31\",\"2024-05-31\",\"2024-05-31\",\"2024-05-31\",\"2024-05-31\",\"2024-05-31\",\"2024-05-31\",\"2024-05-31\",\"2024-05-31\",\"2024-05-31\",\"2024-05-31\",\"2024-05-31\",\"2024-05-31\",\"2024-05-31\",\"2024-05-31\",\"2024-05-31\",\"2024-05-31\",\"2024-05-31\",\"2024-05-31\",\"2024-05-31\",\"2024-05-31\",\"2024-05-31\",\"2024-05-31\",\"2024-05-31\",\"2024-05-31\",\"2024-05-31\",\"2024-05-31\",\"2024-05-31\",\"2024-05-31\",\"2024-05-31\",\"2024-05-31\",\"2024-05-31\",\"2024-05-31\",\"2024-05-31\",\"2024-05-31\",\"2024-05-31\",\"2024-05-31\",\"2024-05-31\",\"2024-05-31\",\"2024-05-31\",\"2024-05-31\",\"2024-05-31\",\"2024-05-31\",\"2024-05-31\",\"2024-05-31\",\"2024-05-31\",\"2024-05-31\",\"2024-05-31\",\"2024-05-31\",\"2024-05-31\",\"2024-05-31\",\"2024-05-31\",\"2024-05-31\",\"2024-05-31\",\"2024-05-31\",\"2024-05-31\",\"2024-05-31\",\"2024-05-31\",\"2024-05-31\",\"2024-05-31\",\"2024-05-31\",\"2024-05-31\",\"2024-05-30\",\"2024-05-30\",\"2024-05-30\",\"2024-05-30\",\"2024-05-30\",\"2024-05-30\",\"2024-05-30\",\"2024-05-30\",\"2024-05-30\",\"2024-05-30\",\"2024-05-30\",\"2024-05-30\",\"2024-05-30\",\"2024-05-30\",\"2024-05-30\",\"2024-05-30\",\"2024-05-30\",\"2024-05-30\",\"2024-05-30\",\"2024-05-30\",\"2024-05-30\",\"2024-05-30\",\"2024-05-30\",\"2024-05-30\",\"2024-05-30\",\"2024-05-30\",\"2024-05-30\",\"2024-05-30\",\"2024-05-30\",\"2024-05-30\",\"2024-05-30\",\"2024-05-30\",\"2024-05-30\",\"2024-05-29\",\"2024-05-29\",\"2024-05-29\",\"2024-05-29\",\"2024-05-29\",\"2024-05-29\",\"2024-05-29\",\"2024-05-29\",\"2024-05-29\",\"2024-05-29\",\"2024-05-29\",\"2024-05-28\",\"2024-05-28\",\"2024-05-28\",\"2024-05-28\",\"2024-05-28\",\"2024-05-28\",\"2024-05-28\",\"2024-05-28\",\"2024-05-28\",\"2024-05-28\",\"2024-05-28\",\"2024-05-28\",\"2024-05-28\",\"2024-05-28\",\"2024-05-28\",\"2024-05-28\",\"2024-05-28\",\"2024-05-28\",\"2024-05-28\",\"2024-05-28\",\"2024-05-28\",\"2024-05-28\",\"2024-05-24\",\"2024-05-24\",\"2024-05-24\",\"2024-05-24\",\"2024-05-24\",\"2024-05-24\",\"2024-05-24\",\"2024-05-24\",\"2024-05-24\",\"2024-05-24\",\"2024-05-24\",\"2024-05-24\",\"2024-05-24\",\"2024-05-24\",\"2024-05-24\",\"2024-05-24\",\"2024-05-24\",\"2024-05-24\",\"2024-05-24\",\"2024-05-24\",\"2024-05-24\",\"2024-05-24\",\"2024-05-24\",\"2024-05-24\",\"2024-05-24\",\"2024-05-24\",\"2024-05-24\",\"2024-05-24\",\"2024-05-24\",\"2024-05-24\",\"2024-05-24\",\"2024-05-24\",\"2024-05-24\",\"2024-05-24\",\"2024-05-24\",\"2024-05-24\",\"2024-05-24\",\"2024-05-24\",\"2024-05-24\",\"2024-05-24\",\"2024-05-24\",\"2024-05-24\",\"2024-05-24\",\"2024-05-24\",\"2024-05-23\",\"2024-05-23\",\"2024-05-23\",\"2024-05-23\",\"2024-05-23\",\"2024-05-23\",\"2024-05-23\",\"2024-05-23\",\"2024-05-23\",\"2024-05-23\",\"2024-05-23\",\"2024-05-19\",\"2024-05-19\",\"2024-05-19\",\"2024-05-19\",\"2024-05-19\",\"2024-05-19\",\"2024-05-19\",\"2024-05-19\",\"2024-05-19\",\"2024-05-19\",\"2024-05-19\",\"2024-05-17\",\"2024-05-17\",\"2024-05-17\",\"2024-05-17\",\"2024-05-17\",\"2024-05-17\",\"2024-05-17\",\"2024-05-17\",\"2024-05-17\",\"2024-05-17\",\"2024-05-17\",\"2024-05-13\",\"2024-05-13\",\"2024-05-13\",\"2024-05-13\",\"2024-05-13\",\"2024-05-13\",\"2024-05-13\",\"2024-05-13\",\"2024-05-13\",\"2024-05-13\",\"2024-05-13\",\"2024-05-09\",\"2024-05-09\",\"2024-05-09\",\"2024-05-09\",\"2024-05-09\",\"2024-05-09\",\"2024-05-09\",\"2024-05-09\",\"2024-05-09\",\"2024-05-09\",\"2024-05-09\",\"2024-04-30\",\"2024-04-30\",\"2024-04-30\",\"2024-04-30\",\"2024-04-30\",\"2024-04-30\",\"2024-04-30\",\"2024-04-30\",\"2024-04-30\",\"2024-04-30\",\"2024-04-30\",\"2024-04-12\",\"2024-04-12\",\"2024-04-12\",\"2024-04-12\",\"2024-04-12\",\"2024-04-12\",\"2024-04-12\",\"2024-04-12\",\"2024-04-12\",\"2024-04-12\",\"2024-04-12\",\"2024-03-21\",\"2024-03-21\",\"2024-03-21\",\"2024-03-21\",\"2024-03-21\",\"2024-03-21\",\"2024-03-21\",\"2024-03-21\",\"2024-03-21\",\"2024-03-21\",\"2024-03-21\",\"2023-12-26\",\"2023-12-26\",\"2023-12-26\",\"2023-12-26\",\"2023-12-26\",\"2023-12-26\",\"2023-12-26\",\"2023-12-26\",\"2023-12-26\",\"2023-12-26\",\"2023-12-26\",\"2023-11-24\",\"2023-11-24\",\"2023-11-24\",\"2023-11-24\",\"2023-11-24\",\"2023-11-24\",\"2023-11-24\",\"2023-11-24\",\"2023-11-24\",\"2023-11-24\",\"2023-11-24\"],[\"okdiario\",\"okdiario\",\"okdiario\",\"okdiario\",\"okdiario\",\"okdiario\",\"okdiario\",\"okdiario\",\"okdiario\",\"okdiario\",\"okdiario\",\"electomania\",\"electomania\",\"electomania\",\"electomania\",\"electomania\",\"electomania\",\"electomania\",\"electomania\",\"electomania\",\"electomania\",\"electomania\",\"elmundo\",\"elmundo\",\"elmundo\",\"elmundo\",\"elmundo\",\"elmundo\",\"elmundo\",\"elmundo\",\"elmundo\",\"elmundo\",\"elmundo\",\"elespañol\",\"elespañol\",\"elespañol\",\"elespañol\",\"elespañol\",\"elespañol\",\"elespañol\",\"elespañol\",\"elespañol\",\"elespañol\",\"elespañol\",\"agendapublica\",\"agendapublica\",\"agendapublica\",\"agendapublica\",\"agendapublica\",\"agendapublica\",\"agendapublica\",\"agendapublica\",\"agendapublica\",\"agendapublica\",\"agendapublica\",\"eldebate\",\"eldebate\",\"eldebate\",\"eldebate\",\"eldebate\",\"eldebate\",\"eldebate\",\"eldebate\",\"eldebate\",\"eldebate\",\"eldebate\",\"prensa_iberica\",\"prensa_iberica\",\"prensa_iberica\",\"prensa_iberica\",\"prensa_iberica\",\"prensa_iberica\",\"prensa_iberica\",\"prensa_iberica\",\"prensa_iberica\",\"prensa_iberica\",\"prensa_iberica\",\"la_razon\",\"la_razon\",\"la_razon\",\"la_razon\",\"la_razon\",\"la_razon\",\"la_razon\",\"la_razon\",\"la_razon\",\"la_razon\",\"la_razon\",\"electomania\",\"electomania\",\"electomania\",\"electomania\",\"electomania\",\"electomania\",\"electomania\",\"electomania\",\"electomania\",\"electomania\",\"electomania\",\"elmundo\",\"elmundo\",\"elmundo\",\"elmundo\",\"elmundo\",\"elmundo\",\"elmundo\",\"elmundo\",\"elmundo\",\"elmundo\",\"elmundo\",\"vozpopuli\",\"vozpopuli\",\"vozpopuli\",\"vozpopuli\",\"vozpopuli\",\"vozpopuli\",\"vozpopuli\",\"vozpopuli\",\"vozpopuli\",\"vozpopuli\",\"vozpopuli\",\"prisa\",\"prisa\",\"prisa\",\"prisa\",\"prisa\",\"prisa\",\"prisa\",\"prisa\",\"prisa\",\"prisa\",\"prisa\",\"abc\",\"abc\",\"abc\",\"abc\",\"abc\",\"abc\",\"abc\",\"abc\",\"abc\",\"abc\",\"abc\",\"cis\",\"cis\",\"cis\",\"cis\",\"cis\",\"cis\",\"cis\",\"cis\",\"cis\",\"cis\",\"cis\",\"metroscopia\",\"metroscopia\",\"metroscopia\",\"metroscopia\",\"metroscopia\",\"metroscopia\",\"metroscopia\",\"metroscopia\",\"metroscopia\",\"metroscopia\",\"metroscopia\",\"ondacero\",\"ondacero\",\"ondacero\",\"ondacero\",\"ondacero\",\"ondacero\",\"ondacero\",\"ondacero\",\"ondacero\",\"ondacero\",\"ondacero\",\"elespañol\",\"elespañol\",\"elespañol\",\"elespañol\",\"elespañol\",\"elespañol\",\"elespañol\",\"elespañol\",\"elespañol\",\"elespañol\",\"elespañol\",\"okdiario\",\"okdiario\",\"okdiario\",\"okdiario\",\"okdiario\",\"okdiario\",\"okdiario\",\"okdiario\",\"okdiario\",\"okdiario\",\"okdiario\",\"mediaset\",\"mediaset\",\"mediaset\",\"mediaset\",\"mediaset\",\"mediaset\",\"mediaset\",\"mediaset\",\"mediaset\",\"mediaset\",\"mediaset\",\"la_razon\",\"la_razon\",\"la_razon\",\"la_razon\",\"la_razon\",\"la_razon\",\"la_razon\",\"la_razon\",\"la_razon\",\"la_razon\",\"la_razon\",\"elmundo\",\"elmundo\",\"elmundo\",\"elmundo\",\"elmundo\",\"elmundo\",\"elmundo\",\"elmundo\",\"elmundo\",\"elmundo\",\"elmundo\",\"agendapublica\",\"agendapublica\",\"agendapublica\",\"agendapublica\",\"agendapublica\",\"agendapublica\",\"agendapublica\",\"agendapublica\",\"agendapublica\",\"agendapublica\",\"agendapublica\",\"elespañol\",\"elespañol\",\"elespañol\",\"elespañol\",\"elespañol\",\"elespañol\",\"elespañol\",\"elespañol\",\"elespañol\",\"elespañol\",\"elespañol\",\"la_razon\",\"la_razon\",\"la_razon\",\"la_razon\",\"la_razon\",\"la_razon\",\"la_razon\",\"la_razon\",\"la_razon\",\"la_razon\",\"la_razon\",\"prisa\",\"prisa\",\"prisa\",\"prisa\",\"prisa\",\"prisa\",\"prisa\",\"prisa\",\"prisa\",\"prisa\",\"prisa\",\"eldiario\",\"eldiario\",\"eldiario\",\"eldiario\",\"eldiario\",\"eldiario\",\"eldiario\",\"eldiario\",\"eldiario\",\"eldiario\",\"eldiario\",\"elmundo\",\"elmundo\",\"elmundo\",\"elmundo\",\"elmundo\",\"elmundo\",\"elmundo\",\"elmundo\",\"elmundo\",\"elmundo\",\"elmundo\",\"elespañol\",\"elespañol\",\"elespañol\",\"elespañol\",\"elespañol\",\"elespañol\",\"elespañol\",\"elespañol\",\"elespañol\",\"elespañol\",\"elespañol\",\"abc\",\"abc\",\"abc\",\"abc\",\"abc\",\"abc\",\"abc\",\"abc\",\"abc\",\"abc\",\"abc\",\"elmundo\",\"elmundo\",\"elmundo\",\"elmundo\",\"elmundo\",\"elmundo\",\"elmundo\",\"elmundo\",\"elmundo\",\"elmundo\",\"elmundo\",\"elespañol\",\"elespañol\",\"elespañol\",\"elespañol\",\"elespañol\",\"elespañol\",\"elespañol\",\"elespañol\",\"elespañol\",\"elespañol\",\"elespañol\"],[1500,1500,1500,1500,1500,1500,1500,1500,1500,1500,1500,1422,1422,1422,1422,1422,1422,1422,1422,1422,1422,1422,3535,3535,3535,3535,3535,3535,3535,3535,3535,3535,3535,630,630,630,630,630,630,630,630,630,630,630,2060,2060,2060,2060,2060,2060,2060,2060,2060,2060,2060,1003,1003,1003,1003,1003,1003,1003,1003,1003,1003,1003,630,630,630,630,630,630,630,630,630,630,630,1000,1000,1000,1000,1000,1000,1000,1000,1000,1000,1000,3109,3109,3109,3109,3109,3109,3109,3109,3109,3109,3109,3948,3948,3948,3948,3948,3948,3948,3948,3948,3948,3948,1000,1000,1000,1000,1000,1000,1000,1000,1000,1000,1000,2000,2000,2000,2000,2000,2000,2000,2000,2000,2000,2000,1005,1005,1005,1005,1005,1005,1005,1005,1005,1005,1005,7491,7491,7491,7491,7491,7491,7491,7491,7491,7491,7491,1000,1000,1000,1000,1000,1000,1000,1000,1000,1000,1000,1100,1100,1100,1100,1100,1100,1100,1100,1100,1100,1100,503,503,503,503,503,503,503,503,503,503,503,1500,1500,1500,1500,1500,1500,1500,1500,1500,1500,1500,1002,1002,1002,1002,1002,1002,1002,1002,1002,1002,1002,1000,1000,1000,1000,1000,1000,1000,1000,1000,1000,1000,2137,2137,2137,2137,2137,2137,2137,2137,2137,2137,2137,1640,1640,1640,1640,1640,1640,1640,1640,1640,1640,1640,519,519,519,519,519,519,519,519,519,519,519,1000,1000,1000,1000,1000,1000,1000,1000,1000,1000,1000,2000,2000,2000,2000,2000,2000,2000,2000,2000,2000,2000,1131,1131,1131,1131,1131,1131,1131,1131,1131,1131,1131,2120,2120,2120,2120,2120,2120,2120,2120,2120,2120,2120,2550,2550,2550,2550,2550,2550,2550,2550,2550,2550,2550,1017,1017,1017,1017,1017,1017,1017,1017,1017,1017,1017,2992,2992,2992,2992,2992,2992,2992,2992,2992,2992,2992,2109,2109,2109,2109,2109,2109,2109,2109,2109,2109,2109],[\"psoe\",\"pp\",\"ciudadanos\",\"podemos\",\"vox\",\"ar\",\"junts\",\"europa_solidaria\",\"sumar\",\"salf\",\"resto\",\"psoe\",\"pp\",\"ciudadanos\",\"podemos\",\"vox\",\"ar\",\"junts\",\"europa_solidaria\",\"sumar\",\"salf\",\"resto\",\"psoe\",\"pp\",\"ciudadanos\",\"podemos\",\"vox\",\"ar\",\"junts\",\"europa_solidaria\",\"sumar\",\"salf\",\"resto\",\"psoe\",\"pp\",\"ciudadanos\",\"podemos\",\"vox\",\"ar\",\"junts\",\"europa_solidaria\",\"sumar\",\"salf\",\"resto\",\"psoe\",\"pp\",\"ciudadanos\",\"podemos\",\"vox\",\"ar\",\"junts\",\"europa_solidaria\",\"sumar\",\"salf\",\"resto\",\"psoe\",\"pp\",\"ciudadanos\",\"podemos\",\"vox\",\"ar\",\"junts\",\"europa_solidaria\",\"sumar\",\"salf\",\"resto\",\"psoe\",\"pp\",\"ciudadanos\",\"podemos\",\"vox\",\"ar\",\"junts\",\"europa_solidaria\",\"sumar\",\"salf\",\"resto\",\"psoe\",\"pp\",\"ciudadanos\",\"podemos\",\"vox\",\"ar\",\"junts\",\"europa_solidaria\",\"sumar\",\"salf\",\"resto\",\"psoe\",\"pp\",\"ciudadanos\",\"podemos\",\"vox\",\"ar\",\"junts\",\"europa_solidaria\",\"sumar\",\"salf\",\"resto\",\"psoe\",\"pp\",\"ciudadanos\",\"podemos\",\"vox\",\"ar\",\"junts\",\"europa_solidaria\",\"sumar\",\"salf\",\"resto\",\"psoe\",\"pp\",\"ciudadanos\",\"podemos\",\"vox\",\"ar\",\"junts\",\"europa_solidaria\",\"sumar\",\"salf\",\"resto\",\"psoe\",\"pp\",\"ciudadanos\",\"podemos\",\"vox\",\"ar\",\"junts\",\"europa_solidaria\",\"sumar\",\"salf\",\"resto\",\"psoe\",\"pp\",\"ciudadanos\",\"podemos\",\"vox\",\"ar\",\"junts\",\"europa_solidaria\",\"sumar\",\"salf\",\"resto\",\"psoe\",\"pp\",\"ciudadanos\",\"podemos\",\"vox\",\"ar\",\"junts\",\"europa_solidaria\",\"sumar\",\"salf\",\"resto\",\"psoe\",\"pp\",\"ciudadanos\",\"podemos\",\"vox\",\"ar\",\"junts\",\"europa_solidaria\",\"sumar\",\"salf\",\"resto\",\"psoe\",\"pp\",\"ciudadanos\",\"podemos\",\"vox\",\"ar\",\"junts\",\"europa_solidaria\",\"sumar\",\"salf\",\"resto\",\"psoe\",\"pp\",\"ciudadanos\",\"podemos\",\"vox\",\"ar\",\"junts\",\"europa_solidaria\",\"sumar\",\"salf\",\"resto\",\"psoe\",\"pp\",\"ciudadanos\",\"podemos\",\"vox\",\"ar\",\"junts\",\"europa_solidaria\",\"sumar\",\"salf\",\"resto\",\"psoe\",\"pp\",\"ciudadanos\",\"podemos\",\"vox\",\"ar\",\"junts\",\"europa_solidaria\",\"sumar\",\"salf\",\"resto\",\"psoe\",\"pp\",\"ciudadanos\",\"podemos\",\"vox\",\"ar\",\"junts\",\"europa_solidaria\",\"sumar\",\"salf\",\"resto\",\"psoe\",\"pp\",\"ciudadanos\",\"podemos\",\"vox\",\"ar\",\"junts\",\"europa_solidaria\",\"sumar\",\"salf\",\"resto\",\"psoe\",\"pp\",\"ciudadanos\",\"podemos\",\"vox\",\"ar\",\"junts\",\"europa_solidaria\",\"sumar\",\"salf\",\"resto\",\"psoe\",\"pp\",\"ciudadanos\",\"podemos\",\"vox\",\"ar\",\"junts\",\"europa_solidaria\",\"sumar\",\"salf\",\"resto\",\"psoe\",\"pp\",\"ciudadanos\",\"podemos\",\"vox\",\"ar\",\"junts\",\"europa_solidaria\",\"sumar\",\"salf\",\"resto\",\"psoe\",\"pp\",\"ciudadanos\",\"podemos\",\"vox\",\"ar\",\"junts\",\"europa_solidaria\",\"sumar\",\"salf\",\"resto\",\"psoe\",\"pp\",\"ciudadanos\",\"podemos\",\"vox\",\"ar\",\"junts\",\"europa_solidaria\",\"sumar\",\"salf\",\"resto\",\"psoe\",\"pp\",\"ciudadanos\",\"podemos\",\"vox\",\"ar\",\"junts\",\"europa_solidaria\",\"sumar\",\"salf\",\"resto\",\"psoe\",\"pp\",\"ciudadanos\",\"podemos\",\"vox\",\"ar\",\"junts\",\"europa_solidaria\",\"sumar\",\"salf\",\"resto\",\"psoe\",\"pp\",\"ciudadanos\",\"podemos\",\"vox\",\"ar\",\"junts\",\"europa_solidaria\",\"sumar\",\"salf\",\"resto\",\"psoe\",\"pp\",\"ciudadanos\",\"podemos\",\"vox\",\"ar\",\"junts\",\"europa_solidaria\",\"sumar\",\"salf\",\"resto\",\"psoe\",\"pp\",\"ciudadanos\",\"podemos\",\"vox\",\"ar\",\"junts\",\"europa_solidaria\",\"sumar\",\"salf\",\"resto\"],[30.2,34.4,1,3.9,10.3,4.4,2.5,1.6,6.2,0,5.5,30.2,32.9,0.8,3.6,9.5,4.2,2.5,1.7,5.9,2.5,6.2,30.3,33.2,0,4.1,10.5,4.3,1.9,1.4,6,3.4,4.89999999999999,29.3,34.1,0.9,3.7,10.1,3.8,2.8,1.6,6.3,2.7,4.7,29.5,33.8,0,3.5,10.3,4.5,2.6,1.7,5.9,2.3,5.90000000000001,31,33.5,0,3.9,8.9,4.5,2.4,0,6,2.9,6.90000000000001,31.5,32,0.9,4.4,8.1,5,2,1.8,5.8,3.7,4.8,29.2,35,0,3.6,9.9,4.9,2.8,1.9,6.4,2.2,4.09999999999999,30,33.5,0.8,3.3,9.199999999999999,4.5,2.5,2,6.3,2,5.89999999999999,29.7,32.7,0.8,4,11,3.8,1.9,1.3,6.9,3.5,4.39999999999999,29.6,35.1,0.9,3.5,10.2,4.5,2.5,0,6.3,2,5.39999999999999,30.1,33.2,1,4,10.7,4.8,2.1,1.4,5.6,2.5,4.59999999999999,29.8,34.9,0,3.5,9.699999999999999,4.8,2.4,1.9,5.9,2.4,4.7,32,29.5,1,3.7,10.1,4,1.6,1.2,6,5.2,5.7,29.5,33.5,0.8,3.6,10.1,4.7,2.3,1.8,5.9,3.1,4.7,29.3,34.9,1,3.6,9.9,4.8,2.6,1.8,6.3,1.9,3.9,29.4,34.8,1.4,3.3,10.7,4.5,2.7,1.4,6.3,2,3.5,29.6,35.4,0.9,2.9,10.4,4.7,2.5,1.7,6.4,0,5.5,31.4,34.5,0.7,3,9.300000000000001,4.5,2.4,1.5,5.7,2.7,4.3,27.9,36.1,0,3,9,5.2,2.9,2.2,6.8,1.2,5.7,30.2,35.1,0.8,3.6,9.699999999999999,3.6,2.4,1.3,7,2.6,3.7,28.7,34.1,0,3.4,9.6,4.5,2.6,1.9,6.7,2.2,6.3,28.8,36.9,0.9,3.2,10.4,5.1,2.4,1.3,7,0.8,3.2,27.2,36.3,0,2.8,9.4,4.9,2.7,2.1,7.7,1.4,5.5,30.1,33.5,1.1,4,12.6,4.6,2.2,1.9,5.7,0,4.3,29.9,36.4,0,2,10.9,4.8,2.2,1.1,8,0,4.7,28.9,35.7,0.8,3.1,11.9,4.1,2,1.8,9.5,0,2.2,26.3,38.1,1.7,2.4,10.9,6.1,2.6,1.8,6.7,0,3.39999999999999,26.5,37.8,0.3,3.5,9.199999999999999,4.4,2.7,2.4,7.2,0,6,29.2,38.1,0.2,2.6,11.8,2.8,2.3,2,10.1,0,0.900000000000006,29.2,36.8,1.1,2,10.2,4.2,5.1,1.3,8,0,2.10000000000001],[453,516,15,58.5,154.5,66.00000000000001,37.5,24,93,0,82.5,429.444,467.838,11.376,51.192,135.09,59.724,35.55,24.174,83.89800000000001,35.55,88.164,1071.105,1173.62,0,144.935,371.175,152.005,67.16500000000001,49.49,212.1,120.19,173.2149999999996,184.59,214.83,5.67,23.31,63.63,23.94,17.64,10.08,39.69,17.01,29.61,607.7,696.28,0,72.09999999999999,212.18,92.7,53.56,35.02,121.54,47.38,121.5400000000002,310.93,336.005,0,39.117,89.26700000000001,45.135,24.072,0,60.18,29.087,69.20700000000009,198.45,201.6,5.67,27.72,51.03,31.5,12.6,11.34,36.54,23.31,30.24,292,350,0,36,99,49,28,19,64,22,40.9999999999999,932.7,1041.515,24.872,102.597,286.028,139.905,77.72499999999999,62.18,195.867,62.18,183.4309999999997,1172.556,1290.996,31.584,157.92,434.28,150.024,75.012,51.32400000000001,272.412,138.18,173.7119999999996,296,351,9,35,102,45,25,0,63,20,53.9999999999999,602,664,20,80,214,96,42,28,112,50,91.9999999999998,299.49,350.745,0,35.175,97.485,48.24,24.12,19.095,59.295,24.12,47.235,2397.12,2209.845,74.91,277.167,756.5909999999999,299.64,119.856,89.892,449.46,389.532,426.987,295,335,8,36,101,47,23,18,59,31,47,322.3,383.9,11,39.6,108.9,52.8,28.6,19.8,69.3,20.9,42.9,147.882,175.044,7.041999999999999,16.599,53.821,22.635,13.581,7.041999999999999,31.689,10.06,17.605,444,531,13.5,43.5,156,70.5,37.5,25.5,96,0,82.5,314.628,345.69,7.013999999999999,30.06,93.18600000000001,45.09,24.048,15.03,57.114,27.054,43.08599999999999,279,361,0,30,90,52,29,22,68,12,57,645.374,750.087,17.096,76.932,207.289,76.932,51.288,27.781,149.59,55.562,79.069,470.68,559.24,0,55.76,157.44,73.8,42.64,31.16,109.88,36.08000000000001,103.32,149.472,191.511,4.671,16.608,53.97600000000001,26.469,12.456,6.747000000000001,36.33,4.152,16.608,272,363,0,28,94,49,27,21,77,14,55,602,670,22,80,252,92,44,38,114,0,86,338.169,411.684,0,22.62,123.279,54.288,24.882,12.441,90.48,0,53.157,612.6799999999999,756.84,16.96,65.72,252.28,86.92,42.4,38.16,201.4,0,46.64,670.65,971.55,43.35,61.2,277.95,155.55,66.3,45.9,170.85,0,86.69999999999975,269.505,384.426,3.051,35.595,93.56399999999999,44.748,27.459,24.408,73.224,0,61.02,873.664,1139.952,5.984,77.792,353.056,83.77600000000001,68.81599999999999,59.84,302.192,0,26.92800000000018,615.828,776.112,23.199,42.18,215.118,88.57800000000002,107.559,27.417,168.72,0,44.28900000000021],[-6,-6,-6,-6,-6,-6,-6,-6,-6,-6,-6,-6,-6,-6,-6,-6,-6,-6,-6,-6,-6,-6,-6,-6,-6,-6,-6,-6,-6,-6,-6,-6,-6,-6,-6,-6,-6,-6,-6,-6,-6,-6,-6,-6,-9,-9,-9,-9,-9,-9,-9,-9,-9,-9,-9,-9,-9,-9,-9,-9,-9,-9,-9,-9,-9,-9,-9,-9,-9,-9,-9,-9,-9,-9,-9,-9,-9,-9,-9,-9,-9,-9,-9,-9,-9,-9,-9,-9,-9,-9,-9,-9,-9,-9,-9,-9,-9,-9,-9,-9,-9,-9,-9,-9,-9,-9,-9,-9,-9,-9,-9,-9,-9,-9,-9,-9,-9,-9,-9,-9,-9,-10,-10,-10,-10,-10,-10,-10,-10,-10,-10,-10,-10,-10,-10,-10,-10,-10,-10,-10,-10,-10,-10,-10,-10,-10,-10,-10,-10,-10,-10,-10,-10,-10,-11,-11,-11,-11,-11,-11,-11,-11,-11,-11,-11,-12,-12,-12,-12,-12,-12,-12,-12,-12,-12,-12,-12,-12,-12,-12,-12,-12,-12,-12,-12,-12,-12,-16,-16,-16,-16,-16,-16,-16,-16,-16,-16,-16,-16,-16,-16,-16,-16,-16,-16,-16,-16,-16,-16,-16,-16,-16,-16,-16,-16,-16,-16,-16,-16,-16,-16,-16,-16,-16,-16,-16,-16,-16,-16,-16,-16,-17,-17,-17,-17,-17,-17,-17,-17,-17,-17,-17,-21,-21,-21,-21,-21,-21,-21,-21,-21,-21,-21,-23,-23,-23,-23,-23,-23,-23,-23,-23,-23,-23,-27,-27,-27,-27,-27,-27,-27,-27,-27,-27,-27,-31,-31,-31,-31,-31,-31,-31,-31,-31,-31,-31,-40,-40,-40,-40,-40,-40,-40,-40,-40,-40,-40,-58,-58,-58,-58,-58,-58,-58,-58,-58,-58,-58,-80,-80,-80,-80,-80,-80,-80,-80,-80,-80,-80,-166,-166,-166,-166,-166,-166,-166,-166,-166,-166,-166,-198,-198,-198,-198,-198,-198,-198,-198,-198,-198,-198]],\"container\":\"<table class=\\\"display\\\">\\n  <thead>\\n    <tr>\\n      <th> <\\/th>\\n      <th>empresa<\\/th>\\n      <th>fecha<\\/th>\\n      <th>medio<\\/th>\\n      <th>n<\\/th>\\n      <th>partido<\\/th>\\n      <th>estim<\\/th>\\n      <th>votos<\\/th>\\n      <th>time<\\/th>\\n    <\\/tr>\\n  <\\/thead>\\n<\\/table>\",\"options\":{\"columnDefs\":[{\"className\":\"dt-right\",\"targets\":[4,6,7]},{\"orderable\":false,\"targets\":0},{\"name\":\" \",\"targets\":0},{\"name\":\"empresa\",\"targets\":1},{\"name\":\"fecha\",\"targets\":2},{\"name\":\"medio\",\"targets\":3},{\"name\":\"n\",\"targets\":4},{\"name\":\"partido\",\"targets\":5},{\"name\":\"estim\",\"targets\":6},{\"name\":\"votos\",\"targets\":7},{\"name\":\"time\",\"targets\":8}],\"order\":[],\"autoWidth\":false,\"orderClasses\":false}},\"evals\":[],\"jsHooks\":[]}</script>\n```\n\n:::\n:::\n\n\n\nPodemos pintar algo, dónde se ve que la distancia entre PSOE y PP ha disminuido conforme se acercaba el día 9 \n\n\n::: {.cell}\n\n```{.r .cell-code}\n\ncolores <-  c(\n    \"psoe\" = \"#FF0126\", \n    \"pp\" = \"#005999\",\n    \"ciudadanos\" = \"#FF5824\",\n    \"podemos\" = \"#8C66F1\",\n    \"vox\" = \"#51962A\", \n    \"ar\" = \"#A06464\",\n    \"junts\" = \"#00C3B2\",\n    \"europa_solidaria\" = \"#00309A\",\n    \"sumar\" = \"#E51C55\", \n    \"salf\" = \"#ECC29E\",\n    \"resto\" = \"grey\"\n    )\n\ndf_new |> \n    ggplot(aes(x = time, y = estim,color = partido )) +\n    geom_point() +\n    scale_color_manual(values = colores) +\n    geom_smooth(se = FALSE)\n```\n\n::: {.cell-output-display}\n![](meta-analisis-europeas_files/figure-html/unnamed-chunk-4-1.png){width=80%}\n:::\n:::\n\n\n\nPara hacer el modelo multinomial necesito que la columna votos tenga valores enteros y que el n sea la suma, así que voy a pivotar y poner todo en orden\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf_wider <- df_new |>  \n    select(-estim) |>  \n    pivot_wider( id_cols = c(empresa, n, time),\n                 names_from = partido, \n                 values_from = votos) |> \n     mutate(across(c(psoe, pp, ciudadanos,podemos,\n                  vox, ar, junts, europa_solidaria,\n                  sumar, salf, resto), round)) |> \n  mutate(\n    n = psoe + pp + ciudadanos + podemos +\n      vox + ar + junts + europa_solidaria + \n      sumar + salf + resto\n  )\n\nDT::datatable(df_wider)\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"datatables html-widget html-fill-item\" id=\"htmlwidget-98a67c8e9ccaa8fb60e0\" style=\"width:100%;height:auto;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-98a67c8e9ccaa8fb60e0\">{\"x\":{\"filter\":\"none\",\"vertical\":false,\"data\":[[\"1\",\"2\",\"3\",\"4\",\"5\",\"6\",\"7\",\"8\",\"9\",\"10\",\"11\",\"12\",\"13\",\"14\",\"15\",\"16\",\"17\",\"18\",\"19\",\"20\",\"21\",\"22\",\"23\",\"24\",\"25\",\"26\",\"27\",\"28\",\"29\",\"30\",\"31\"],[\"data10\",\"electopanel\",\"sigmados\",\"sociometrica\",\"cluster17\",\"targetpoint\",\"gesop\",\"nc_report\",\"electopanel\",\"sigmados\",\"hamalgama\",\"40db\",\"gad3\",\"cis\",\"metroscopia\",\"celestetel\",\"sociometrica\",\"data10\",\"gad3\",\"nc_report\",\"sigmados\",\"cluster17\",\"sociometrica\",\"nc_report\",\"40db\",\"simplelogica\",\"sigmados\",\"sociometrica\",\"gad3\",\"sigmados\",\"sociometrica\"],[1500,1422,3534,632,2061,1002,631,1000,3110,3948,1000,2000,1003,7492,1000,1101,505,1501,1002,1000,2137,1640,519,1000,2000,1130,2120,2551,1017,2993,2109],[-6,-6,-6,-6,-9,-9,-9,-9,-9,-9,-9,-10,-10,-10,-11,-12,-12,-16,-16,-16,-16,-17,-21,-23,-27,-31,-40,-58,-80,-166,-198],[453,429,1071,185,608,311,198,292,933,1173,296,602,299,2397,295,322,148,444,315,279,645,471,149,272,602,338,613,671,270,874,616],[516,468,1174,215,696,336,202,350,1042,1291,351,664,351,2210,335,384,175,531,346,361,750,559,192,363,670,412,757,972,384,1140,776],[15,11,0,6,0,0,6,0,25,32,9,20,0,75,8,11,7,14,7,0,17,0,5,0,22,0,17,43,3,6,23],[58,51,145,23,72,39,28,36,103,158,35,80,35,277,36,40,17,44,30,30,77,56,17,28,80,23,66,61,36,78,42],[155,135,371,64,212,89,51,99,286,434,102,214,97,757,101,109,54,156,93,90,207,157,54,94,252,123,252,278,94,353,215],[66,60,152,24,93,45,32,49,140,150,45,96,48,300,47,53,23,70,45,52,77,74,26,49,92,54,87,156,45,84,89],[38,36,67,18,54,24,13,28,78,75,25,42,24,120,23,29,14,38,24,29,51,43,12,27,44,25,42,66,27,69,108],[24,24,49,10,35,0,11,19,62,51,0,28,19,90,18,20,7,26,15,22,28,31,7,21,38,12,38,46,24,60,27],[93,84,212,40,122,60,37,64,196,272,63,112,59,449,59,69,32,96,57,68,150,110,36,77,114,90,201,171,73,302,169],[0,36,120,17,47,29,23,22,62,138,20,50,24,390,31,21,10,0,27,12,56,36,4,14,0,0,0,0,0,0,0],[82,88,173,30,122,69,30,41,183,174,54,92,47,427,47,43,18,82,43,57,79,103,17,55,86,53,47,87,61,27,44]],\"container\":\"<table class=\\\"display\\\">\\n  <thead>\\n    <tr>\\n      <th> <\\/th>\\n      <th>empresa<\\/th>\\n      <th>n<\\/th>\\n      <th>time<\\/th>\\n      <th>psoe<\\/th>\\n      <th>pp<\\/th>\\n      <th>ciudadanos<\\/th>\\n      <th>podemos<\\/th>\\n      <th>vox<\\/th>\\n      <th>ar<\\/th>\\n      <th>junts<\\/th>\\n      <th>europa_solidaria<\\/th>\\n      <th>sumar<\\/th>\\n      <th>salf<\\/th>\\n      <th>resto<\\/th>\\n    <\\/tr>\\n  <\\/thead>\\n<\\/table>\",\"options\":{\"columnDefs\":[{\"className\":\"dt-right\",\"targets\":[2,4,5,6,7,8,9,10,11,12,13,14]},{\"orderable\":false,\"targets\":0},{\"name\":\" \",\"targets\":0},{\"name\":\"empresa\",\"targets\":1},{\"name\":\"n\",\"targets\":2},{\"name\":\"time\",\"targets\":3},{\"name\":\"psoe\",\"targets\":4},{\"name\":\"pp\",\"targets\":5},{\"name\":\"ciudadanos\",\"targets\":6},{\"name\":\"podemos\",\"targets\":7},{\"name\":\"vox\",\"targets\":8},{\"name\":\"ar\",\"targets\":9},{\"name\":\"junts\",\"targets\":10},{\"name\":\"europa_solidaria\",\"targets\":11},{\"name\":\"sumar\",\"targets\":12},{\"name\":\"salf\",\"targets\":13},{\"name\":\"resto\",\"targets\":14}],\"order\":[],\"autoWidth\":false,\"orderClasses\":false}},\"evals\":[],\"jsHooks\":[]}</script>\n```\n\n:::\n:::\n\n\nEl modelo lo voy a ajustar usando `brms` y necesito tener una columna que sea la concatenación de los diferentes votos a cada partido. \n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n\ndf_wider$cell_counts <- with(df_wider, cbind(psoe, pp, ciudadanos,podemos,\n                                             vox, ar, junts, europa_solidaria,\n                                             sumar, salf, resto))\n\n\nDT::datatable(df_wider |> select(empresa, time, n, cell_counts))\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"datatables html-widget html-fill-item\" id=\"htmlwidget-ff26f8cef778db963830\" style=\"width:100%;height:auto;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-ff26f8cef778db963830\">{\"x\":{\"filter\":\"none\",\"vertical\":false,\"data\":[[\"1\",\"2\",\"3\",\"4\",\"5\",\"6\",\"7\",\"8\",\"9\",\"10\",\"11\",\"12\",\"13\",\"14\",\"15\",\"16\",\"17\",\"18\",\"19\",\"20\",\"21\",\"22\",\"23\",\"24\",\"25\",\"26\",\"27\",\"28\",\"29\",\"30\",\"31\"],[\"data10\",\"electopanel\",\"sigmados\",\"sociometrica\",\"cluster17\",\"targetpoint\",\"gesop\",\"nc_report\",\"electopanel\",\"sigmados\",\"hamalgama\",\"40db\",\"gad3\",\"cis\",\"metroscopia\",\"celestetel\",\"sociometrica\",\"data10\",\"gad3\",\"nc_report\",\"sigmados\",\"cluster17\",\"sociometrica\",\"nc_report\",\"40db\",\"simplelogica\",\"sigmados\",\"sociometrica\",\"gad3\",\"sigmados\",\"sociometrica\"],[-6,-6,-6,-6,-9,-9,-9,-9,-9,-9,-9,-10,-10,-10,-11,-12,-12,-16,-16,-16,-16,-17,-21,-23,-27,-31,-40,-58,-80,-166,-198],[1500,1422,3534,632,2061,1002,631,1000,3110,3948,1000,2000,1003,7492,1000,1101,505,1501,1002,1000,2137,1640,519,1000,2000,1130,2120,2551,1017,2993,2109],[[453,516,15,58,155,66,38,24,93,0,82],[429,468,11,51,135,60,36,24,84,36,88],[1071,1174,0,145,371,152,67,49,212,120,173],[185,215,6,23,64,24,18,10,40,17,30],[608,696,0,72,212,93,54,35,122,47,122],[311,336,0,39,89,45,24,0,60,29,69],[198,202,6,28,51,32,13,11,37,23,30],[292,350,0,36,99,49,28,19,64,22,41],[933,1042,25,103,286,140,78,62,196,62,183],[1173,1291,32,158,434,150,75,51,272,138,174],[296,351,9,35,102,45,25,0,63,20,54],[602,664,20,80,214,96,42,28,112,50,92],[299,351,0,35,97,48,24,19,59,24,47],[2397,2210,75,277,757,300,120,90,449,390,427],[295,335,8,36,101,47,23,18,59,31,47],[322,384,11,40,109,53,29,20,69,21,43],[148,175,7,17,54,23,14,7,32,10,18],[444,531,14,44,156,70,38,26,96,0,82],[315,346,7,30,93,45,24,15,57,27,43],[279,361,0,30,90,52,29,22,68,12,57],[645,750,17,77,207,77,51,28,150,56,79],[471,559,0,56,157,74,43,31,110,36,103],[149,192,5,17,54,26,12,7,36,4,17],[272,363,0,28,94,49,27,21,77,14,55],[602,670,22,80,252,92,44,38,114,0,86],[338,412,0,23,123,54,25,12,90,0,53],[613,757,17,66,252,87,42,38,201,0,47],[671,972,43,61,278,156,66,46,171,0,87],[270,384,3,36,94,45,27,24,73,0,61],[874,1140,6,78,353,84,69,60,302,0,27],[616,776,23,42,215,89,108,27,169,0,44]]],\"container\":\"<table class=\\\"display\\\">\\n  <thead>\\n    <tr>\\n      <th> <\\/th>\\n      <th>empresa<\\/th>\\n      <th>time<\\/th>\\n      <th>n<\\/th>\\n      <th>cell_counts<\\/th>\\n    <\\/tr>\\n  <\\/thead>\\n<\\/table>\",\"options\":{\"columnDefs\":[{\"className\":\"dt-right\",\"targets\":[3,4]},{\"orderable\":false,\"targets\":0},{\"name\":\" \",\"targets\":0},{\"name\":\"empresa\",\"targets\":1},{\"name\":\"time\",\"targets\":2},{\"name\":\"n\",\"targets\":3},{\"name\":\"cell_counts\",\"targets\":4}],\"order\":[],\"autoWidth\":false,\"orderClasses\":false}},\"evals\":[],\"jsHooks\":[]}</script>\n```\n\n:::\n:::\n\n\nY con esto ya puedo\n\n\n## Modelo meta análisis\n\n\n::: {.cell}\n\n```{.r .cell-code}\n\nlibrary(cmdstanr)\nlibrary(brms)\nlibrary(tidybayes)\n\noptions(brms.backend=\"cmdstanr\")\n```\n:::\n\n\nEn la especificación del modelo pongo la empresa como efecto aleatorio y añado también un término general que recoja la tendencia temporal global y por empresa encuestadora.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nformula <- brmsformula(\n    cell_counts | trials(n) ~  (time |empresa) + time)\n```\n:::\n\n\n\nVemos las priors por defecto que usa brms. Lo suyo sería estudiar con cuidado todo este tema para elegir unas priors informativas si se pudiera. \n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# vemos las priors por defecto qeu h\n(priors <- get_prior(formula, df_wider, family = multinomial()))\n#>                 prior     class      coef   group resp              dpar nlpar\n#>                lkj(1)       cor                                               \n#>                lkj(1)       cor           empresa                             \n#>                (flat)         b                                     muar      \n#>                (flat)         b      time                           muar      \n#>  student_t(3, 0, 2.5) Intercept                                     muar      \n#>  student_t(3, 0, 2.5)        sd                                     muar      \n#>  student_t(3, 0, 2.5)        sd           empresa                   muar      \n#>  student_t(3, 0, 2.5)        sd Intercept empresa                   muar      \n#>  student_t(3, 0, 2.5)        sd      time empresa                   muar      \n#>                (flat)         b                             muciudadanos      \n#>                (flat)         b      time                   muciudadanos      \n#>  student_t(3, 0, 2.5) Intercept                             muciudadanos      \n#>  student_t(3, 0, 2.5)        sd                             muciudadanos      \n#>  student_t(3, 0, 2.5)        sd           empresa           muciudadanos      \n#>  student_t(3, 0, 2.5)        sd Intercept empresa           muciudadanos      \n#>  student_t(3, 0, 2.5)        sd      time empresa           muciudadanos      \n#>                (flat)         b                        mueuropasolidaria      \n#>                (flat)         b      time              mueuropasolidaria      \n#>  student_t(3, 0, 2.5) Intercept                        mueuropasolidaria      \n#>  student_t(3, 0, 2.5)        sd                        mueuropasolidaria      \n#>  student_t(3, 0, 2.5)        sd           empresa      mueuropasolidaria      \n#>  student_t(3, 0, 2.5)        sd Intercept empresa      mueuropasolidaria      \n#>  student_t(3, 0, 2.5)        sd      time empresa      mueuropasolidaria      \n#>                (flat)         b                                  mujunts      \n#>                (flat)         b      time                        mujunts      \n#>  student_t(3, 0, 2.5) Intercept                                  mujunts      \n#>  student_t(3, 0, 2.5)        sd                                  mujunts      \n#>  student_t(3, 0, 2.5)        sd           empresa                mujunts      \n#>  student_t(3, 0, 2.5)        sd Intercept empresa                mujunts      \n#>  student_t(3, 0, 2.5)        sd      time empresa                mujunts      \n#>                (flat)         b                                mupodemos      \n#>                (flat)         b      time                      mupodemos      \n#>  student_t(3, 0, 2.5) Intercept                                mupodemos      \n#>  student_t(3, 0, 2.5)        sd                                mupodemos      \n#>  student_t(3, 0, 2.5)        sd           empresa              mupodemos      \n#>  student_t(3, 0, 2.5)        sd Intercept empresa              mupodemos      \n#>  student_t(3, 0, 2.5)        sd      time empresa              mupodemos      \n#>                (flat)         b                                     mupp      \n#>                (flat)         b      time                           mupp      \n#>  student_t(3, 0, 2.5) Intercept                                     mupp      \n#>  student_t(3, 0, 2.5)        sd                                     mupp      \n#>  student_t(3, 0, 2.5)        sd           empresa                   mupp      \n#>  student_t(3, 0, 2.5)        sd Intercept empresa                   mupp      \n#>  student_t(3, 0, 2.5)        sd      time empresa                   mupp      \n#>                (flat)         b                                  muresto      \n#>                (flat)         b      time                        muresto      \n#>  student_t(3, 0, 2.5) Intercept                                  muresto      \n#>  student_t(3, 0, 2.5)        sd                                  muresto      \n#>  student_t(3, 0, 2.5)        sd           empresa                muresto      \n#>  student_t(3, 0, 2.5)        sd Intercept empresa                muresto      \n#>  student_t(3, 0, 2.5)        sd      time empresa                muresto      \n#>                (flat)         b                                   musalf      \n#>                (flat)         b      time                         musalf      \n#>  student_t(3, 0, 2.5) Intercept                                   musalf      \n#>  student_t(3, 0, 2.5)        sd                                   musalf      \n#>  student_t(3, 0, 2.5)        sd           empresa                 musalf      \n#>  student_t(3, 0, 2.5)        sd Intercept empresa                 musalf      \n#>  student_t(3, 0, 2.5)        sd      time empresa                 musalf      \n#>                (flat)         b                                  musumar      \n#>                (flat)         b      time                        musumar      \n#>  student_t(3, 0, 2.5) Intercept                                  musumar      \n#>  student_t(3, 0, 2.5)        sd                                  musumar      \n#>  student_t(3, 0, 2.5)        sd           empresa                musumar      \n#>  student_t(3, 0, 2.5)        sd Intercept empresa                musumar      \n#>  student_t(3, 0, 2.5)        sd      time empresa                musumar      \n#>                (flat)         b                                    muvox      \n#>                (flat)         b      time                          muvox      \n#>  student_t(3, 0, 2.5) Intercept                                    muvox      \n#>  student_t(3, 0, 2.5)        sd                                    muvox      \n#>  student_t(3, 0, 2.5)        sd           empresa                  muvox      \n#>  student_t(3, 0, 2.5)        sd Intercept empresa                  muvox      \n#>  student_t(3, 0, 2.5)        sd      time empresa                  muvox      \n#>  lb ub       source\n#>             default\n#>        (vectorized)\n#>             default\n#>        (vectorized)\n#>             default\n#>   0         default\n#>   0    (vectorized)\n#>   0    (vectorized)\n#>   0    (vectorized)\n#>             default\n#>        (vectorized)\n#>             default\n#>   0         default\n#>   0    (vectorized)\n#>   0    (vectorized)\n#>   0    (vectorized)\n#>             default\n#>        (vectorized)\n#>             default\n#>   0         default\n#>   0    (vectorized)\n#>   0    (vectorized)\n#>   0    (vectorized)\n#>             default\n#>        (vectorized)\n#>             default\n#>   0         default\n#>   0    (vectorized)\n#>   0    (vectorized)\n#>   0    (vectorized)\n#>             default\n#>        (vectorized)\n#>             default\n#>   0         default\n#>   0    (vectorized)\n#>   0    (vectorized)\n#>   0    (vectorized)\n#>             default\n#>        (vectorized)\n#>             default\n#>   0         default\n#>   0    (vectorized)\n#>   0    (vectorized)\n#>   0    (vectorized)\n#>             default\n#>        (vectorized)\n#>             default\n#>   0         default\n#>   0    (vectorized)\n#>   0    (vectorized)\n#>   0    (vectorized)\n#>             default\n#>        (vectorized)\n#>             default\n#>   0         default\n#>   0    (vectorized)\n#>   0    (vectorized)\n#>   0    (vectorized)\n#>             default\n#>        (vectorized)\n#>             default\n#>   0         default\n#>   0    (vectorized)\n#>   0    (vectorized)\n#>   0    (vectorized)\n#>             default\n#>        (vectorized)\n#>             default\n#>   0         default\n#>   0    (vectorized)\n#>   0    (vectorized)\n#>   0    (vectorized)\n```\n:::\n\n\n### Ajuste con brms\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n\nmodel_multinomial <-\n    brm(\n        formula,\n        df_wider,\n        multinomial(),\n        prior = priors,\n        iter = 4000,\n        warmup = 1000,\n        cores = 4,\n        chains = 4, \n        file = here::here(\"2024/06/mod_meta_europeas\"),\n    )\n\nsummary(model_multinomial)\n#>  Family: multinomial \n#>   Links: mupp = logit; muciudadanos = logit; mupodemos = logit; muvox = logit; muar = logit; mujunts = logit; mueuropasolidaria = logit; musumar = logit; musalf = logit; muresto = logit \n#> Formula: cell_counts | trials(n) ~ (time | empresa) + time \n#>    Data: df_wider (Number of observations: 31) \n#>   Draws: 2 chains, each with iter = 4000; warmup = 1000; thin = 1;\n#>          total post-warmup draws = 6000\n#> \n#> Multilevel Hyperparameters:\n#> ~empresa (Number of levels: 15) \n#>                                                         Estimate Est.Error\n#> sd(mupp_Intercept)                                          0.08      0.02\n#> sd(mupp_time)                                               0.00      0.00\n#> sd(muciudadanos_Intercept)                                  1.73      0.58\n#> sd(muciudadanos_time)                                       0.01      0.01\n#> sd(mupodemos_Intercept)                                     0.05      0.04\n#> sd(mupodemos_time)                                          0.00      0.00\n#> sd(muvox_Intercept)                                         0.05      0.03\n#> sd(muvox_time)                                              0.00      0.00\n#> sd(muar_Intercept)                                          0.09      0.04\n#> sd(muar_time)                                               0.00      0.00\n#> sd(mujunts_Intercept)                                       0.15      0.06\n#> sd(mujunts_time)                                            0.00      0.00\n#> sd(mueuropasolidaria_Intercept)                             0.80      0.31\n#> sd(mueuropasolidaria_time)                                  0.01      0.01\n#> sd(musumar_Intercept)                                       0.06      0.04\n#> sd(musumar_time)                                            0.00      0.00\n#> sd(musalf_Intercept)                                        1.31      0.51\n#> sd(musalf_time)                                             0.10      0.04\n#> sd(muresto_Intercept)                                       0.10      0.07\n#> sd(muresto_time)                                            0.01      0.00\n#> cor(mupp_Intercept,mupp_time)                               0.29      0.52\n#> cor(muciudadanos_Intercept,muciudadanos_time)              -0.23      0.58\n#> cor(mupodemos_Intercept,mupodemos_time)                     0.10      0.58\n#> cor(muvox_Intercept,muvox_time)                             0.05      0.59\n#> cor(muar_Intercept,muar_time)                              -0.17      0.51\n#> cor(mujunts_Intercept,mujunts_time)                        -0.13      0.56\n#> cor(mueuropasolidaria_Intercept,mueuropasolidaria_time)     0.19      0.63\n#> cor(musumar_Intercept,musumar_time)                        -0.03      0.56\n#> cor(musalf_Intercept,musalf_time)                           0.37      0.38\n#> cor(muresto_Intercept,muresto_time)                        -0.11      0.51\n#>                                                         l-95% CI u-95% CI Rhat\n#> sd(mupp_Intercept)                                          0.04     0.13 1.00\n#> sd(mupp_time)                                               0.00     0.00 1.00\n#> sd(muciudadanos_Intercept)                                  0.84     3.13 1.00\n#> sd(muciudadanos_time)                                       0.00     0.05 1.00\n#> sd(mupodemos_Intercept)                                     0.00     0.15 1.00\n#> sd(mupodemos_time)                                          0.00     0.01 1.00\n#> sd(muvox_Intercept)                                         0.00     0.12 1.00\n#> sd(muvox_time)                                              0.00     0.01 1.00\n#> sd(muar_Intercept)                                          0.01     0.19 1.00\n#> sd(muar_time)                                               0.00     0.01 1.00\n#> sd(mujunts_Intercept)                                       0.03     0.30 1.00\n#> sd(mujunts_time)                                            0.00     0.01 1.00\n#> sd(mueuropasolidaria_Intercept)                             0.35     1.52 1.00\n#> sd(mueuropasolidaria_time)                                  0.00     0.03 1.00\n#> sd(musumar_Intercept)                                       0.00     0.14 1.00\n#> sd(musumar_time)                                            0.00     0.01 1.00\n#> sd(musalf_Intercept)                                        0.53     2.52 1.00\n#> sd(musalf_time)                                             0.04     0.20 1.00\n#> sd(muresto_Intercept)                                       0.01     0.25 1.00\n#> sd(muresto_time)                                            0.00     0.02 1.00\n#> cor(mupp_Intercept,mupp_time)                              -0.80     0.97 1.00\n#> cor(muciudadanos_Intercept,muciudadanos_time)              -0.98     0.91 1.00\n#> cor(mupodemos_Intercept,mupodemos_time)                    -0.93     0.96 1.00\n#> cor(muvox_Intercept,muvox_time)                            -0.95     0.96 1.00\n#> cor(muar_Intercept,muar_time)                              -0.96     0.79 1.00\n#> cor(mujunts_Intercept,mujunts_time)                        -0.97     0.88 1.00\n#> cor(mueuropasolidaria_Intercept,mueuropasolidaria_time)    -0.94     0.99 1.00\n#> cor(musumar_Intercept,musumar_time)                        -0.96     0.92 1.00\n#> cor(musalf_Intercept,musalf_time)                          -0.49     0.91 1.00\n#> cor(muresto_Intercept,muresto_time)                        -0.95     0.83 1.00\n#>                                                         Bulk_ESS Tail_ESS\n#> sd(mupp_Intercept)                                          3195     4001\n#> sd(mupp_time)                                               2226     2389\n#> sd(muciudadanos_Intercept)                                  1196      782\n#> sd(muciudadanos_time)                                       1253      687\n#> sd(mupodemos_Intercept)                                     3080     3141\n#> sd(mupodemos_time)                                          1411     2934\n#> sd(muvox_Intercept)                                         2362     3231\n#> sd(muvox_time)                                              1754     3067\n#> sd(muar_Intercept)                                          2195     1342\n#> sd(muar_time)                                               1948     3040\n#> sd(mujunts_Intercept)                                       1707     1039\n#> sd(mujunts_time)                                            1687     1254\n#> sd(mueuropasolidaria_Intercept)                             1493     2842\n#> sd(mueuropasolidaria_time)                                  1964     2282\n#> sd(musumar_Intercept)                                       2149      895\n#> sd(musumar_time)                                            1765     2996\n#> sd(musalf_Intercept)                                        1587     1236\n#> sd(musalf_time)                                             1398     1922\n#> sd(muresto_Intercept)                                       2011     2922\n#> sd(muresto_time)                                            2145     3064\n#> cor(mupp_Intercept,mupp_time)                               5781     4411\n#> cor(muciudadanos_Intercept,muciudadanos_time)               6101     4338\n#> cor(mupodemos_Intercept,mupodemos_time)                     3000     3892\n#> cor(muvox_Intercept,muvox_time)                             4119     3862\n#> cor(muar_Intercept,muar_time)                               4117     4341\n#> cor(mujunts_Intercept,mujunts_time)                         3736     3839\n#> cor(mueuropasolidaria_Intercept,mueuropasolidaria_time)     3570     3560\n#> cor(musumar_Intercept,musumar_time)                         3785     3838\n#> cor(musalf_Intercept,musalf_time)                           2478     3113\n#> cor(muresto_Intercept,muresto_time)                         1655     2268\n#> \n#> Regression Coefficients:\n#>                             Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS\n#> mupp_Intercept                  0.12      0.03     0.06     0.17 1.00     4247\n#> muciudadanos_Intercept         -4.35      0.51    -5.46    -3.44 1.00     1660\n#> mupodemos_Intercept            -2.09      0.04    -2.18    -2.01 1.00     4929\n#> muvox_Intercept                -1.09      0.03    -1.15    -1.04 1.00     6204\n#> muar_Intercept                 -1.87      0.04    -1.95    -1.78 1.00     4436\n#> mujunts_Intercept              -2.60      0.06    -2.72    -2.47 1.00     5477\n#> mueuropasolidaria_Intercept    -3.20      0.24    -3.73    -2.76 1.00     1818\n#> musumar_Intercept              -1.58      0.04    -1.66    -1.52 1.00     5585\n#> musalf_Intercept               -1.82      0.46    -2.74    -0.90 1.00     2711\n#> muresto_Intercept              -1.78      0.06    -1.90    -1.65 1.00     3720\n#> mupp_time                      -0.00      0.00    -0.00     0.00 1.00     4669\n#> muciudadanos_time               0.00      0.01    -0.01     0.02 1.00     2370\n#> mupodemos_time                  0.00      0.00    -0.00     0.01 1.00     3425\n#> muvox_time                     -0.00      0.00    -0.00     0.00 1.00     3952\n#> muar_time                       0.00      0.00    -0.00     0.00 1.00     4523\n#> mujunts_time                   -0.00      0.00    -0.01     0.00 1.00     4341\n#> mueuropasolidaria_time         -0.00      0.01    -0.02     0.00 1.00     2307\n#> musumar_time                   -0.00      0.00    -0.01     0.00 1.00     4455\n#> musalf_time                     0.09      0.04     0.01     0.16 1.00     1641\n#> muresto_time                   -0.00      0.00    -0.01     0.01 1.00     2554\n#>                             Tail_ESS\n#> mupp_Intercept                  4114\n#> muciudadanos_Intercept          2252\n#> mupodemos_Intercept             4637\n#> muvox_Intercept                 4966\n#> muar_Intercept                  3290\n#> mujunts_Intercept               5073\n#> mueuropasolidaria_Intercept     2660\n#> musumar_Intercept               4243\n#> musalf_Intercept                3752\n#> muresto_Intercept               4273\n#> mupp_time                       3415\n#> muciudadanos_time               1550\n#> mupodemos_time                  2887\n#> muvox_time                      3376\n#> muar_time                       3352\n#> mujunts_time                    2454\n#> mueuropasolidaria_time          2064\n#> musumar_time                    3421\n#> musalf_time                     1854\n#> muresto_time                    2462\n#> \n#> Draws were sampled using sample(hmc). For each parameter, Bulk_ESS\n#> and Tail_ESS are effective sample size measures, and Rhat is the potential\n#> scale reduction factor on split chains (at convergence, Rhat = 1).\n```\n:::\n\n\n## Estimación para el día de las elecciones\n\nAnte todo mucha calma, como diría Siniestro Total. La info que tenemos sólo tiene en cuenta lo publicado por  las empresas, no sabemos nada de cómo lo han cocinado cada una y tampoco de la muestra efectiva. Esto es sólo un ejercicio para mi propia diversión personal. \n\n¿Cómo obtendríamos la predicción para el día de las elecciones? El modelo multinomial devuelve el número de votos a repartir dado un _n_ , si considro n = 1 me devuelve las proporciones estimadas.  Lo que voy a hacer es considerar que las elecciones es \"una nueva encuesta\" con \n`n = 1`  y con `time = 0`  y que tenemos un nuevo nivel en la empresa encuestadora.  \n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnewdata <- tibble(\n    empresa = \"votaciones_dia_9\", \n    time = 0,\n    n= 1)\n\nnewdata\n#> # A tibble: 1 × 3\n#>   empresa           time     n\n#>   <chr>            <dbl> <dbl>\n#> 1 votaciones_dia_9     0     1\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nestimaciones <-  newdata |> \n    add_epred_draws(model_multinomial, allow_new_levels = TRUE) |> \n    mutate(partido = as_factor(.category)) |> \n    select(-.category)\n\ndim(estimaciones )\n#> [1] 66000    10\n\nDT::datatable(head(estimaciones, 100))\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"datatables html-widget html-fill-item\" id=\"htmlwidget-90f9cd068497e9e96d22\" style=\"width:100%;height:auto;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-90f9cd068497e9e96d22\">{\"x\":{\"filter\":\"none\",\"vertical\":false,\"data\":[[\"1\",\"2\",\"3\",\"4\",\"5\",\"6\",\"7\",\"8\",\"9\",\"10\",\"11\",\"12\",\"13\",\"14\",\"15\",\"16\",\"17\",\"18\",\"19\",\"20\",\"21\",\"22\",\"23\",\"24\",\"25\",\"26\",\"27\",\"28\",\"29\",\"30\",\"31\",\"32\",\"33\",\"34\",\"35\",\"36\",\"37\",\"38\",\"39\",\"40\",\"41\",\"42\",\"43\",\"44\",\"45\",\"46\",\"47\",\"48\",\"49\",\"50\",\"51\",\"52\",\"53\",\"54\",\"55\",\"56\",\"57\",\"58\",\"59\",\"60\",\"61\",\"62\",\"63\",\"64\",\"65\",\"66\",\"67\",\"68\",\"69\",\"70\",\"71\",\"72\",\"73\",\"74\",\"75\",\"76\",\"77\",\"78\",\"79\",\"80\",\"81\",\"82\",\"83\",\"84\",\"85\",\"86\",\"87\",\"88\",\"89\",\"90\",\"91\",\"92\",\"93\",\"94\",\"95\",\"96\",\"97\",\"98\",\"99\",\"100\"],[\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\"],[\"votaciones_dia_9\",\"votaciones_dia_9\",\"votaciones_dia_9\",\"votaciones_dia_9\",\"votaciones_dia_9\",\"votaciones_dia_9\",\"votaciones_dia_9\",\"votaciones_dia_9\",\"votaciones_dia_9\",\"votaciones_dia_9\",\"votaciones_dia_9\",\"votaciones_dia_9\",\"votaciones_dia_9\",\"votaciones_dia_9\",\"votaciones_dia_9\",\"votaciones_dia_9\",\"votaciones_dia_9\",\"votaciones_dia_9\",\"votaciones_dia_9\",\"votaciones_dia_9\",\"votaciones_dia_9\",\"votaciones_dia_9\",\"votaciones_dia_9\",\"votaciones_dia_9\",\"votaciones_dia_9\",\"votaciones_dia_9\",\"votaciones_dia_9\",\"votaciones_dia_9\",\"votaciones_dia_9\",\"votaciones_dia_9\",\"votaciones_dia_9\",\"votaciones_dia_9\",\"votaciones_dia_9\",\"votaciones_dia_9\",\"votaciones_dia_9\",\"votaciones_dia_9\",\"votaciones_dia_9\",\"votaciones_dia_9\",\"votaciones_dia_9\",\"votaciones_dia_9\",\"votaciones_dia_9\",\"votaciones_dia_9\",\"votaciones_dia_9\",\"votaciones_dia_9\",\"votaciones_dia_9\",\"votaciones_dia_9\",\"votaciones_dia_9\",\"votaciones_dia_9\",\"votaciones_dia_9\",\"votaciones_dia_9\",\"votaciones_dia_9\",\"votaciones_dia_9\",\"votaciones_dia_9\",\"votaciones_dia_9\",\"votaciones_dia_9\",\"votaciones_dia_9\",\"votaciones_dia_9\",\"votaciones_dia_9\",\"votaciones_dia_9\",\"votaciones_dia_9\",\"votaciones_dia_9\",\"votaciones_dia_9\",\"votaciones_dia_9\",\"votaciones_dia_9\",\"votaciones_dia_9\",\"votaciones_dia_9\",\"votaciones_dia_9\",\"votaciones_dia_9\",\"votaciones_dia_9\",\"votaciones_dia_9\",\"votaciones_dia_9\",\"votaciones_dia_9\",\"votaciones_dia_9\",\"votaciones_dia_9\",\"votaciones_dia_9\",\"votaciones_dia_9\",\"votaciones_dia_9\",\"votaciones_dia_9\",\"votaciones_dia_9\",\"votaciones_dia_9\",\"votaciones_dia_9\",\"votaciones_dia_9\",\"votaciones_dia_9\",\"votaciones_dia_9\",\"votaciones_dia_9\",\"votaciones_dia_9\",\"votaciones_dia_9\",\"votaciones_dia_9\",\"votaciones_dia_9\",\"votaciones_dia_9\",\"votaciones_dia_9\",\"votaciones_dia_9\",\"votaciones_dia_9\",\"votaciones_dia_9\",\"votaciones_dia_9\",\"votaciones_dia_9\",\"votaciones_dia_9\",\"votaciones_dia_9\",\"votaciones_dia_9\",\"votaciones_dia_9\"],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100],[0.2887832068136934,0.2933369433164841,0.2973703140118965,0.2877170464869279,0.3042905095277006,0.2869114831630672,0.2783140337057876,0.2771106663329386,0.2260235238960641,0.302215318816315,0.3018394283532703,0.3164545477327801,0.292512753046986,0.2823385879553196,0.2990578803083821,0.2193114047578702,0.2009785825833199,0.3037320853381989,0.2688328582888873,0.2990932583397265,0.297530711390003,0.2961542867433536,0.2892119218382171,0.2635440958201182,0.3037830462456761,0.287187642100894,0.2995508580327704,0.3059005262011126,0.2650635223617156,0.2755375373979609,0.2795249699391677,0.2743620380517506,0.2888057692297695,0.2949907627460858,0.2857364067847491,0.2922637444486399,0.2970592956286882,0.2054311045377315,0.3054265472286896,0.2925581106614737,0.275678189258778,0.2869075206910902,0.2849797083981735,0.291629974491328,0.3118587337337135,0.2986960856967718,0.2643676285569263,0.2979804827269336,0.3014867044644163,0.2911681300671763,0.2825326803348359,0.3069382564978081,0.270149183382808,0.2642531287684539,0.3013121123648312,0.2804162581398003,0.2963936990225027,0.2831405496770656,0.3119444379516569,0.2741304104198857,0.2923297976066291,0.2891854825582835,0.3021224350532384,0.2851470577895737,0.2993154247663463,0.2789875939381243,0.2957531156922152,0.2743534502661697,0.2929647019747325,0.2796627197878597,0.2529443012048389,0.2787614737481721,0.2862046539352455,0.310382569839795,0.2820431844686765,0.2951440265874531,0.2988585045591839,0.3134783022861688,0.2899292348219365,0.2747192730672244,0.29211218808774,0.2961492849049051,0.283399926357085,0.2920619330744419,0.2882534364225104,0.2895702683506991,0.2810506177115715,0.2977476337853557,0.3191624677445143,0.3039483053424538,0.2840456815399113,0.2792622438298985,0.09665121395452657,0.2733903084772018,0.2818894320831941,0.3041015771673827,0.261692570529805,0.2925486901983946,0.2463068188613896,0.2795332549030534],[\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\",\"psoe\"]],\"container\":\"<table class=\\\"display\\\">\\n  <thead>\\n    <tr>\\n      <th> <\\/th>\\n      <th>.category<\\/th>\\n      <th>empresa<\\/th>\\n      <th>time<\\/th>\\n      <th>n<\\/th>\\n      <th>.row<\\/th>\\n      <th>.chain<\\/th>\\n      <th>.iteration<\\/th>\\n      <th>.draw<\\/th>\\n      <th>.epred<\\/th>\\n      <th>partido<\\/th>\\n    <\\/tr>\\n  <\\/thead>\\n<\\/table>\",\"options\":{\"columnDefs\":[{\"className\":\"dt-right\",\"targets\":[3,4,5,6,7,8,9]},{\"orderable\":false,\"targets\":0},{\"name\":\" \",\"targets\":0},{\"name\":\".category\",\"targets\":1},{\"name\":\"empresa\",\"targets\":2},{\"name\":\"time\",\"targets\":3},{\"name\":\"n\",\"targets\":4},{\"name\":\".row\",\"targets\":5},{\"name\":\".chain\",\"targets\":6},{\"name\":\".iteration\",\"targets\":7},{\"name\":\".draw\",\"targets\":8},{\"name\":\".epred\",\"targets\":9},{\"name\":\"partido\",\"targets\":10}],\"order\":[],\"autoWidth\":false,\"orderClasses\":false}},\"evals\":[],\"jsHooks\":[]}</script>\n```\n\n:::\n:::\n\n\nY ya que tengo las posterioris, puedo obtener resúmenes de la distribución . como calcular un intervalo de credibilidad para cada partido, al 90% por ejemplo \n\n\n::: {.cell}\n\n```{.r .cell-code}\nestimaciones |> \n    group_by(partido) |> \n    summarise(\n        media = mean(.epred), \n        mediana= median(.epred), \n        low = quantile(.epred, 0.05), \n        high= quantile(.epred, 0.95)\n    ) |> \nmutate(across(media:high, \\(x){100* round(x,3)})) # sintaxis nueva y rara para funciones anónimas\n#> # A tibble: 11 × 5\n#>    partido          media mediana   low  high\n#>    <fct>            <dbl>   <dbl> <dbl> <dbl>\n#>  1 psoe              28.4    28.9  24.1  30.9\n#>  2 pp                32      32.8  25.8  35.6\n#>  3 ciudadanos         0.6     0.7   0     1.4\n#>  4 podemos            3.5     3.5   2.9   4  \n#>  5 vox                9.5     9.7   8    10.6\n#>  6 ar                 4.4     4.4   3.6   5.2\n#>  7 junts              2.1     2.1   1.5   2.7\n#>  8 europa_solidaria   1.3     1.4   0.2   2.2\n#>  9 sumar              5.8     6     4.8   6.6\n#> 10 salf               7.3     5.2   0.4  22  \n#> 11 resto              4.8     4.8   3.8   6\n```\n:::\n\n\nComo vemos, yo diría que empate técnico entre psoe y pp. y para algunos partidos como _salf_ \nmejor no dar ni el dato dado el intervalo de credibilidad tan ancho. \n\n\nPintamos \n\n\n::: {.cell}\n\n```{.r .cell-code}\nestimaciones %>% \n    ggplot(aes(x=.epred, fill = partido)) +\n    geom_density(alpha = 0.5 ) +\n    scale_x_continuous(labels = scales::percent, limits = c(0, 0.45)) +\n    scale_fill_manual(values = colores) +\n    labs(title=\"Agregando encuestas por diversión. Resultado\",\n        x = \"Porcentaje estimado\", \n        y = \"Density\") \n```\n\n::: {.cell-output-display}\n![](meta-analisis-europeas_files/figure-html/unnamed-chunk-14-1.png){width=80%}\n:::\n:::\n\n\n\nUn detalle curioso, y si \"la nueva encuesta a día 0\"  la hiciera el cis. Aunque eso si, gracias al modelo bayesiano matizando un poco sus ansias de victoria socialista. \n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncis <- tibble(\n    empresa = \"cis\", \n    time = 0,\n    n= 1)\n\ncis\n#> # A tibble: 1 × 3\n#>   empresa  time     n\n#>   <chr>   <dbl> <dbl>\n#> 1 cis         0     1\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n    \nestimaciones_cis <-  cis |> \n    add_epred_draws(model_multinomial, allow_new_levels = TRUE) |> \n    mutate(partido = as_factor(.category)) |> \n    select(-.category)\n\nestimaciones_cis |> \n    group_by(partido) |> \n    summarise(\n        media = mean(.epred), \n        mediana= median(.epred), \n        low = quantile(.epred, 0.05), \n        high= quantile(.epred, 0.95)\n    ) |> \nmutate(across(media:high, \\(x){100* round(x,3)}))   \n#> # A tibble: 11 × 5\n#>    partido          media mediana   low  high\n#>    <fct>            <dbl>   <dbl> <dbl> <dbl>\n#>  1 psoe              28.5    29.5  21.6  32.2\n#>  2 pp                27.2    28.1  20.7  30.9\n#>  3 ciudadanos         0.9     0.9   0.6   1.2\n#>  4 podemos            3.5     3.6   2.7   4.1\n#>  5 vox                9.4     9.7   7    10.8\n#>  6 ar                 3.9     4     2.9   4.6\n#>  7 junts              1.6     1.7   1.2   2.1\n#>  8 europa_solidaria   1.1     1.1   0.7   1.4\n#>  9 sumar              5.6     5.8   4.2   6.5\n#> 10 salf              13       9.9   2.3  33.6\n#> 11 resto              5       5.1   3.7   6.1\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nestimaciones_cis %>% \n    ggplot(aes(x=.epred, fill = partido)) +\n    geom_density(alpha = 0.5 ) +\n    scale_x_continuous(labels = scales::percent, limits = c(0, 0.45)) +\n    scale_fill_manual(values = colores) +\n    labs(title=\"Si yo fuera Tezanos\",\n        x = \"Porcentaje estimado\", \n        y = \"Density\") \n```\n\n::: {.cell-output-display}\n![](meta-analisis-europeas_files/figure-html/unnamed-chunk-17-1.png){width=80%}\n:::\n:::\n\n\n## Finalizando\n\nSea como fuere, esto es sólo por diversión con el objetivo de mostrar un poco como se pueden agregar encuestas de forma bayesiana. Otra forma es hacer simulaciones como hace Kiko Llaneras. A mi me gusta más al modo bayesiano, y creo que debería salir algo parecido. \nPues nada más, vayan a votar  o no, no es una obligación sino un derecho. Feliz sábado",
    "supporting": [
      "meta-analisis-europeas_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../../site_libs/htmltools-fill-0.5.8.1/fill.css\" rel=\"stylesheet\" />\n<script src=\"../../site_libs/htmlwidgets-1.6.4/htmlwidgets.js\"></script>\n<link href=\"../../site_libs/datatables-css-0.0.0/datatables-crosstalk.css\" rel=\"stylesheet\" />\n<script src=\"../../site_libs/datatables-binding-0.33/datatables.js\"></script>\n<script src=\"../../site_libs/jquery-3.6.0/jquery-3.6.0.min.js\"></script>\n<link href=\"../../site_libs/dt-core-1.13.6/css/jquery.dataTables.min.css\" rel=\"stylesheet\" />\n<link href=\"../../site_libs/dt-core-1.13.6/css/jquery.dataTables.extra.css\" rel=\"stylesheet\" />\n<script src=\"../../site_libs/dt-core-1.13.6/js/jquery.dataTables.min.js\"></script>\n<link href=\"../../site_libs/crosstalk-1.2.1/css/crosstalk.min.css\" rel=\"stylesheet\" />\n<script src=\"../../site_libs/crosstalk-1.2.1/js/crosstalk.min.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}