{
  "hash": "533a555e8d7b525c177f28281e1be615",
  "result": {
    "markdown": "---\ntitle: Malditas proporciones pequeñas III\ndate: '2019-07-03'\ncategories:\n  - 2019\n  - estadística\n  - R\ndescription: ''\nexecute: \n  message: false\n  warning: false\n  echo: true\nformat: \n  html: \n    fig-height: 5\n    fig-dpi: 300\n    fig-width: 8.88\n    fig-align: center\nknitr:\n  opts_chunk:\n    out.width: 80%\n    fig.showtext: TRUE\n    collapse: true\n    comment: \"#>\"\n---\n\n\nVolviendo al ejemplo de lo de las proporciones pequeñas, se trataba básicamente de que se tenía una población con una prevalencia de cierto evento del 4 x 1000 más o menos y en post anteriores veíamos cómo calcular tamaños de muestra y tal para ver cómo detectar un incremento de un 15% en esa proporción.\n\nAhora vamos a suponer que tenemos una población de 1.5 millones, pero que hay 5 grupos diferenciados, con prevalencias del 6, 5, 4, 3 y 2 por mil respectivamente y todos del mismo tamaño. Simulemos dicha población\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(155)\n\ngr1 <- rbinom(n = 3E5, size = 1, prob = 0.006)\ngr2 <- rbinom(n = 3E5, size = 1, prob = 0.005)\ngr3 <- rbinom(n = 3E5, size = 1, prob = 0.004)\ngr4 <- rbinom(n = 3E5, size = 1, prob = 0.003)\ngr5 <- rbinom(n = 3E5, size = 1, prob = 0.002)\n\npop <-  data.frame(grupo = rep(letters[1:5],each= 3E5),\n                   evento = c(gr1,gr2,gr3,gr4,gr5))\n```\n:::\n\n\nVeamos 30 casos al azar.\n\n\n::: {.cell}\n\n```{.r .cell-code}\npop[sample(1:nrow(pop), 30),]\n#>         grupo evento\n#> 92075       a      0\n#> 424873      b      0\n#> 1201923     e      0\n#> 1159523     d      0\n#> 830570      c      0\n#> 546477      b      0\n#> 1120381     d      0\n#> 613315      c      0\n#> 485130      b      0\n#> 52029       a      0\n#> 619858      c      0\n#> 590223      b      0\n#> 1034676     d      0\n#> 1153071     d      0\n#> 1266210     e      0\n#> 502866      b      0\n#> 99782       a      0\n#> 1388671     e      0\n#> 26049       a      0\n#> 971047      d      0\n#> 709908      c      0\n#> 376850      b      0\n#> 487569      b      0\n#> 365383      b      0\n#> 376533      b      0\n#> 1094390     d      0\n#> 873846      c      0\n#> 514258      b      0\n#> 1423814     e      0\n#> 730321      c      0\n```\n:::\n\n\nComprobamos la prevalencia en la población total y por grupos\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmean(pop$evento)\n#> [1] 0.003958\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nwith(pop,tapply(evento, grupo, mean))\n#>           a           b           c           d           e \n#> 0.005836667 0.004963333 0.004213333 0.002846667 0.001930000\n```\n:::\n\n\nSupongamos ahora que encuentro un grupo por ahí del mismo tamaño (300k) con una prevalencia igual al mejor grupo que tengo, es decir, del 6 x 1000 y que la gente de marketing me cree y me deja que quite 300K con peor prevalencia y que los sustituya con mi grupo.  ¿Cuánto sería la mejora de la prevalencia en esa nueva población?\n\nSimulemos\n\n\n::: {.cell}\n\n```{.r .cell-code}\npop_new <- pop\npop_new$evento[pop_new$grupo==\"e\"] <- rbinom(n = 3E5, size = 1, prob = 0.006)\n\nmean(pop_new$evento)\n#> [1] 0.004748667\nmean(pop_new$evento)/mean(pop$evento)\n#> [1] 1.199764\n```\n:::\n\n\nLa mejora sería del 19.9764191, % pero, ¿es porque he tenido suerte?. Si todos los meses encontrara un grupo así de majo, ¿en qué valores de mejora me estaría moviendo?\n\nSimulemos 100 realizaciones de este ejercicio\n\n\n::: {.cell}\n\n```{.r .cell-code}\nres <- replicate(100, {\n  pop$evento[pop$grupo==\"e\"] <- rbinom(n = 3E5, size = 1, prob = 0.006)\n  return(100 * (mean(pop$evento) / 0.004 - 1))\n})\n```\n:::\n\n\n\nY si dibujamos la función de densidad tenemos\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(density(res), main = \"% de mejora\", lwd = 2, col = \"darkblue\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-7-1.png){width=80%}\n:::\n:::\n\n\n\nVaya, pues parece que aún encontrando ese grupo tan molón y quitando el grupo malo mi mejora se va a quedar en torno al 19%.. Uhmm, ¿qué le digo a mi jefe cuándo me pida una mejora del 30%? \n\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}